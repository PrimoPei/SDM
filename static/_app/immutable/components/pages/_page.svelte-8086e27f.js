import{S as Ye,i as Ge,s as je,k as ee,H as qt,a as ue,q as xe,l as te,m as W,I as Yt,h as D,c as ce,r as Ee,n as P,b as le,F as K,u as Sn,A as ge,v as Ie,w as Se,x as Ae,f as q,t as j,y as Pe,G as he,o as an,J as re,K as An,L as ct,M as ei,N as dr,O as yo,P as wo,Q as bo,R as ko,T as xo,g as Xe,d as qe,U as Eo,e as Re,V as Oo,W as Io,X as So}from"../../chunks/index-78e14b76.js";import{w as Ue}from"../../chunks/index-307410f3.js";var Ao={value:()=>{}};function Yn(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Ft(n)}function Ft(e){this._=e}function Po(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Ft.prototype=Yn.prototype={constructor:Ft,on:function(e,t){var n=this._,r=Po(e+"",n),i,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((i=(e=r[o]).type)&&(i=To(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(i=(e=r[o]).type)n[i]=pr(n[i],e.name,t);else if(t==null)for(i in n)n[i]=pr(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ft(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=this._[e],r=0,i=o.length;r<i;++r)o[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,o=r.length;i<o;++i)r[i].value.apply(t,n)}};function To(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function pr(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=Ao,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Pn="http://www.w3.org/1999/xhtml";const mr={svg:"http://www.w3.org/2000/svg",xhtml:Pn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ln(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),mr.hasOwnProperty(t)?{space:mr[t],local:e}:e}function No(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Pn&&t.documentElement.namespaceURI===Pn?t.createElement(e):t.createElementNS(n,e)}}function Mo(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ti(e){var t=ln(e);return(t.local?Mo:No)(t)}function Lo(){}function Gn(e){return e==null?Lo:function(){return this.querySelector(e)}}function Ro(e){typeof e!="function"&&(e=Gn(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o=t[i],s=o.length,a=r[i]=new Array(s),l,u,c=0;c<s;++c)(l=o[c])&&(u=e.call(l,l.__data__,c,o))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new ve(r,this._parents)}function Co(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Uo(){return[]}function ni(e){return e==null?Uo:function(){return this.querySelectorAll(e)}}function $o(e){return function(){return Co(e.apply(this,arguments))}}function Do(e){typeof e=="function"?e=$o(e):e=ni(e);for(var t=this._groups,n=t.length,r=[],i=[],o=0;o<n;++o)for(var s=t[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&(r.push(e.call(l,l.__data__,u,s)),i.push(l));return new ve(r,i)}function ri(e){return function(){return this.matches(e)}}function ii(e){return function(t){return t.matches(e)}}var zo=Array.prototype.find;function Fo(e){return function(){return zo.call(this.children,e)}}function Ko(){return this.firstElementChild}function Ho(e){return this.select(e==null?Ko:Fo(typeof e=="function"?e:ii(e)))}var Vo=Array.prototype.filter;function Bo(){return Array.from(this.children)}function Xo(e){return function(){return Vo.call(this.children,e)}}function qo(e){return this.selectAll(e==null?Bo:Xo(typeof e=="function"?e:ii(e)))}function Yo(e){typeof e!="function"&&(e=ri(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o=t[i],s=o.length,a=r[i]=[],l,u=0;u<s;++u)(l=o[u])&&e.call(l,l.__data__,u,o)&&a.push(l);return new ve(r,this._parents)}function oi(e){return new Array(e.length)}function Go(){return new ve(this._enter||this._groups.map(oi),this._parents)}function Gt(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Gt.prototype={constructor:Gt,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function jo(e){return function(){return e}}function Jo(e,t,n,r,i,o){for(var s=0,a,l=t.length,u=o.length;s<u;++s)(a=t[s])?(a.__data__=o[s],r[s]=a):n[s]=new Gt(e,o[s]);for(;s<l;++s)(a=t[s])&&(i[s]=a)}function Wo(e,t,n,r,i,o,s){var a,l,u=new Map,c=t.length,f=o.length,p=new Array(c),v;for(a=0;a<c;++a)(l=t[a])&&(p[a]=v=s.call(l,l.__data__,a,t)+"",u.has(v)?i[a]=l:u.set(v,l));for(a=0;a<f;++a)v=s.call(e,o[a],a,o)+"",(l=u.get(v))?(r[a]=l,l.__data__=o[a],u.delete(v)):n[a]=new Gt(e,o[a]);for(a=0;a<c;++a)(l=t[a])&&u.get(p[a])===l&&(i[a]=l)}function Zo(e){return e.__data__}function Qo(e,t){if(!arguments.length)return Array.from(this,Zo);var n=t?Wo:Jo,r=this._parents,i=this._groups;typeof e!="function"&&(e=jo(e));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),u=0;u<o;++u){var c=r[u],f=i[u],p=f.length,v=es(e.call(c,c&&c.__data__,u,r)),O=v.length,U=a[u]=new Array(O),H=s[u]=new Array(O),b=l[u]=new Array(p);n(c,f,U,H,b,v,t);for(var B=0,y=0,E,M;B<O;++B)if(E=U[B]){for(B>=y&&(y=B+1);!(M=H[y])&&++y<O;);E._next=M||null}}return s=new ve(s,r),s._enter=a,s._exit=l,s}function es(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ts(){return new ve(this._exit||this._groups.map(oi),this._parents)}function ns(e,t,n){var r=this.enter(),i=this,o=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(i=t(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function rs(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var u=n[l],c=r[l],f=u.length,p=a[l]=new Array(f),v,O=0;O<f;++O)(v=u[O]||c[O])&&(p[O]=v);for(;l<i;++l)a[l]=n[l];return new ve(a,this._parents)}function is(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,o=r[i],s;--i>=0;)(s=r[i])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function os(e){e||(e=ss);function t(f,p){return f&&p?e(f.__data__,p.__data__):!f-!p}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s=n[o],a=s.length,l=i[o]=new Array(a),u,c=0;c<a;++c)(u=s[c])&&(l[c]=u);l.sort(t)}return new ve(i,this._parents).order()}function ss(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function as(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function ls(){return Array.from(this)}function us(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null}function cs(){let e=0;for(const t of this)++e;return e}function fs(){return!this.node()}function hs(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],o=0,s=i.length,a;o<s;++o)(a=i[o])&&e.call(a,a.__data__,o,i);return this}function ds(e){return function(){this.removeAttribute(e)}}function ps(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ms(e,t){return function(){this.setAttribute(e,t)}}function _s(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function gs(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function vs(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function ys(e,t){var n=ln(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?ps:ds:typeof t=="function"?n.local?vs:gs:n.local?_s:ms)(n,t))}function si(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ws(e){return function(){this.style.removeProperty(e)}}function bs(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ks(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function xs(e,t,n){return arguments.length>1?this.each((t==null?ws:typeof t=="function"?ks:bs)(e,t,n==null?"":n)):pt(this.node(),e)}function pt(e,t){return e.style.getPropertyValue(t)||si(e).getComputedStyle(e,null).getPropertyValue(t)}function Es(e){return function(){delete this[e]}}function Os(e,t){return function(){this[e]=t}}function Is(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Ss(e,t){return arguments.length>1?this.each((t==null?Es:typeof t=="function"?Is:Os)(e,t)):this.node()[e]}function ai(e){return e.trim().split(/^|\s+/)}function jn(e){return e.classList||new li(e)}function li(e){this._node=e,this._names=ai(e.getAttribute("class")||"")}li.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function ui(e,t){for(var n=jn(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function ci(e,t){for(var n=jn(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function As(e){return function(){ui(this,e)}}function Ps(e){return function(){ci(this,e)}}function Ts(e,t){return function(){(t.apply(this,arguments)?ui:ci)(this,e)}}function Ns(e,t){var n=ai(e+"");if(arguments.length<2){for(var r=jn(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?Ts:t?As:Ps)(n,t))}function Ms(){this.textContent=""}function Ls(e){return function(){this.textContent=e}}function Rs(e){return function(){var t=e.apply(this,arguments);this.textContent=t==null?"":t}}function Cs(e){return arguments.length?this.each(e==null?Ms:(typeof e=="function"?Rs:Ls)(e)):this.node().textContent}function Us(){this.innerHTML=""}function $s(e){return function(){this.innerHTML=e}}function Ds(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t==null?"":t}}function zs(e){return arguments.length?this.each(e==null?Us:(typeof e=="function"?Ds:$s)(e)):this.node().innerHTML}function Fs(){this.nextSibling&&this.parentNode.appendChild(this)}function Ks(){return this.each(Fs)}function Hs(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Vs(){return this.each(Hs)}function Bs(e){var t=typeof e=="function"?e:ti(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Xs(){return null}function qs(e,t){var n=typeof e=="function"?e:ti(e),r=t==null?Xs:typeof t=="function"?t:Gn(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Ys(){var e=this.parentNode;e&&e.removeChild(this)}function Gs(){return this.each(Ys)}function js(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Js(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Ws(e){return this.select(e?Js:js)}function Zs(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Qs(e){return function(t){e.call(this,t,this.__data__)}}function ea(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function ta(e){return function(){var t=this.__on;if(!!t){for(var n=0,r=-1,i=t.length,o;n<i;++n)o=t[n],(!e.type||o.type===e.type)&&o.name===e.name?this.removeEventListener(o.type,o.listener,o.options):t[++r]=o;++r?t.length=r:delete this.__on}}}function na(e,t,n){return function(){var r=this.__on,i,o=Qs(t);if(r){for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=t;return}}this.addEventListener(e.type,o,n),i={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(i):this.__on=[i]}}function ra(e,t,n){var r=ea(e+""),i,o=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(i=0,c=a[l];i<o;++i)if((s=r[i]).type===c.type&&s.name===c.name)return c.value}return}for(a=t?na:ta,i=0;i<o;++i)this.each(a(r[i],t,n));return this}function fi(e,t,n){var r=si(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function ia(e,t){return function(){return fi(this,e,t)}}function oa(e,t){return function(){return fi(this,e,t.apply(this,arguments))}}function sa(e,t){return this.each((typeof t=="function"?oa:ia)(e,t))}function*aa(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length,s;i<o;++i)(s=r[i])&&(yield s)}var hi=[null];function ve(e,t){this._groups=e,this._parents=t}function Tt(){return new ve([[document.documentElement]],hi)}function la(){return this}ve.prototype=Tt.prototype={constructor:ve,select:Ro,selectAll:Do,selectChild:Ho,selectChildren:qo,filter:Yo,data:Qo,enter:Go,exit:ts,join:ns,merge:rs,selection:la,order:is,sort:os,call:as,nodes:ls,node:us,size:cs,empty:fs,each:hs,attr:ys,style:xs,property:Ss,classed:Ns,text:Cs,html:zs,raise:Ks,lower:Vs,append:Bs,insert:qs,remove:Gs,clone:Ws,datum:Zs,on:ra,dispatch:sa,[Symbol.iterator]:aa};function Ve(e){return typeof e=="string"?new ve([[document.querySelector(e)]],[document.documentElement]):new ve([[e]],hi)}function ua(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Qe(e,t){if(e=ua(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const Tn={capture:!0,passive:!1};function Nn(e){e.preventDefault(),e.stopImmediatePropagation()}function ca(e){var t=e.document.documentElement,n=Ve(e).on("dragstart.drag",Nn,Tn);"onselectstart"in t?n.on("selectstart.drag",Nn,Tn):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function fa(e,t){var n=e.document.documentElement,r=Ve(e).on("dragstart.drag",null);t&&(r.on("click.drag",Nn,Tn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Jn(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function di(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Nt(){}var It=.7,jt=1/It,ht="\\s*([+-]?\\d+)\\s*",St="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ce="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ha=/^#([0-9a-f]{3,8})$/,da=new RegExp(`^rgb\\(${ht},${ht},${ht}\\)$`),pa=new RegExp(`^rgb\\(${Ce},${Ce},${Ce}\\)$`),ma=new RegExp(`^rgba\\(${ht},${ht},${ht},${St}\\)$`),_a=new RegExp(`^rgba\\(${Ce},${Ce},${Ce},${St}\\)$`),ga=new RegExp(`^hsl\\(${St},${Ce},${Ce}\\)$`),va=new RegExp(`^hsla\\(${St},${Ce},${Ce},${St}\\)$`),_r={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Jn(Nt,ot,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:gr,formatHex:gr,formatHex8:ya,formatHsl:wa,formatRgb:vr,toString:vr});function gr(){return this.rgb().formatHex()}function ya(){return this.rgb().formatHex8()}function wa(){return pi(this).formatHsl()}function vr(){return this.rgb().formatRgb()}function ot(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ha.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?yr(t):n===3?new pe(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Lt(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Lt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=da.exec(e))?new pe(t[1],t[2],t[3],1):(t=pa.exec(e))?new pe(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ma.exec(e))?Lt(t[1],t[2],t[3],t[4]):(t=_a.exec(e))?Lt(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=ga.exec(e))?kr(t[1],t[2]/100,t[3]/100,1):(t=va.exec(e))?kr(t[1],t[2]/100,t[3]/100,t[4]):_r.hasOwnProperty(e)?yr(_r[e]):e==="transparent"?new pe(NaN,NaN,NaN,0):null}function yr(e){return new pe(e>>16&255,e>>8&255,e&255,1)}function Lt(e,t,n,r){return r<=0&&(e=t=n=NaN),new pe(e,t,n,r)}function ba(e){return e instanceof Nt||(e=ot(e)),e?(e=e.rgb(),new pe(e.r,e.g,e.b,e.opacity)):new pe}function Mn(e,t,n,r){return arguments.length===1?ba(e):new pe(e,t,n,r==null?1:r)}function pe(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Jn(pe,Mn,di(Nt,{brighter(e){return e=e==null?jt:Math.pow(jt,e),new pe(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?It:Math.pow(It,e),new pe(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new pe(nt(this.r),nt(this.g),nt(this.b),Jt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wr,formatHex:wr,formatHex8:ka,formatRgb:br,toString:br}));function wr(){return`#${tt(this.r)}${tt(this.g)}${tt(this.b)}`}function ka(){return`#${tt(this.r)}${tt(this.g)}${tt(this.b)}${tt((isNaN(this.opacity)?1:this.opacity)*255)}`}function br(){const e=Jt(this.opacity);return`${e===1?"rgb(":"rgba("}${nt(this.r)}, ${nt(this.g)}, ${nt(this.b)}${e===1?")":`, ${e})`}`}function Jt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function nt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function tt(e){return e=nt(e),(e<16?"0":"")+e.toString(16)}function kr(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Oe(e,t,n,r)}function pi(e){if(e instanceof Oe)return new Oe(e.h,e.s,e.l,e.opacity);if(e instanceof Nt||(e=ot(e)),!e)return new Oe;if(e instanceof Oe)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(t===o?s=(n-r)/a+(n<r)*6:n===o?s=(r-t)/a+2:s=(t-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new Oe(s,a,l,e.opacity)}function xa(e,t,n,r){return arguments.length===1?pi(e):new Oe(e,t,n,r==null?1:r)}function Oe(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Jn(Oe,xa,di(Nt,{brighter(e){return e=e==null?jt:Math.pow(jt,e),new Oe(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?It:Math.pow(It,e),new Oe(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new pe(vn(e>=240?e-240:e+120,i,r),vn(e,i,r),vn(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Oe(xr(this.h),Rt(this.s),Rt(this.l),Jt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Jt(this.opacity);return`${e===1?"hsl(":"hsla("}${xr(this.h)}, ${Rt(this.s)*100}%, ${Rt(this.l)*100}%${e===1?")":`, ${e})`}`}}));function xr(e){return e=(e||0)%360,e<0?e+360:e}function Rt(e){return Math.max(0,Math.min(1,e||0))}function vn(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Wn=e=>()=>e;function Ea(e,t){return function(n){return e+n*t}}function Oa(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Ia(e){return(e=+e)==1?mi:function(t,n){return n-t?Oa(t,n,e):Wn(isNaN(t)?n:t)}}function mi(e,t){var n=t-e;return n?Ea(e,n):Wn(isNaN(e)?t:e)}const Wt=function e(t){var n=Ia(t);function r(i,o){var s=n((i=Mn(i)).r,(o=Mn(o)).r),a=n(i.g,o.g),l=n(i.b,o.b),u=mi(i.opacity,o.opacity);return function(c){return i.r=s(c),i.g=a(c),i.b=l(c),i.opacity=u(c),i+""}}return r.gamma=e,r}(1);function Sa(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(o){for(i=0;i<n;++i)r[i]=e[i]*(1-o)+t[i]*o;return r}}function Aa(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Pa(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),o=new Array(n),s;for(s=0;s<r;++s)i[s]=Zn(e[s],t[s]);for(;s<n;++s)o[s]=t[s];return function(a){for(s=0;s<r;++s)o[s]=i[s](a);return o}}function Ta(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function ke(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Na(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Zn(e[i],t[i]):r[i]=t[i];return function(o){for(i in n)r[i]=n[i](o);return r}}var Ln=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,yn=new RegExp(Ln.source,"g");function Ma(e){return function(){return e}}function La(e){return function(t){return e(t)+""}}function _i(e,t){var n=Ln.lastIndex=yn.lastIndex=0,r,i,o,s=-1,a=[],l=[];for(e=e+"",t=t+"";(r=Ln.exec(e))&&(i=yn.exec(t));)(o=i.index)>n&&(o=t.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:ke(r,i)})),n=yn.lastIndex;return n<t.length&&(o=t.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?La(l[0].x):Ma(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)a[(f=l[c]).i]=f.x(u);return a.join("")})}function Zn(e,t){var n=typeof t,r;return t==null||n==="boolean"?Wn(t):(n==="number"?ke:n==="string"?(r=ot(t))?(t=r,Wt):_i:t instanceof ot?Wt:t instanceof Date?Ta:Aa(t)?Sa:Array.isArray(t)?Pa:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Na:ke)(e,t)}function Ra(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var Er=180/Math.PI,Rn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function gi(e,t,n,r,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*Er,skewX:Math.atan(l)*Er,scaleX:s,scaleY:a}}var Ct;function Ca(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Rn:gi(t.a,t.b,t.c,t.d,t.e,t.f)}function Ua(e){return e==null||(Ct||(Ct=document.createElementNS("http://www.w3.org/2000/svg","g")),Ct.setAttribute("transform",e),!(e=Ct.transform.baseVal.consolidate()))?Rn:(e=e.matrix,gi(e.a,e.b,e.c,e.d,e.e,e.f))}function vi(e,t,n,r){function i(u){return u.length?u.pop()+" ":""}function o(u,c,f,p,v,O){if(u!==f||c!==p){var U=v.push("translate(",null,t,null,n);O.push({i:U-4,x:ke(u,f)},{i:U-2,x:ke(c,p)})}else(f||p)&&v.push("translate("+f+t+p+n)}function s(u,c,f,p){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),p.push({i:f.push(i(f)+"rotate(",null,r)-2,x:ke(u,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(u,c,f,p){u!==c?p.push({i:f.push(i(f)+"skewX(",null,r)-2,x:ke(u,c)}):c&&f.push(i(f)+"skewX("+c+r)}function l(u,c,f,p,v,O){if(u!==f||c!==p){var U=v.push(i(v)+"scale(",null,",",null,")");O.push({i:U-4,x:ke(u,f)},{i:U-2,x:ke(c,p)})}else(f!==1||p!==1)&&v.push(i(v)+"scale("+f+","+p+")")}return function(u,c){var f=[],p=[];return u=e(u),c=e(c),o(u.translateX,u.translateY,c.translateX,c.translateY,f,p),s(u.rotate,c.rotate,f,p),a(u.skewX,c.skewX,f,p),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,f,p),u=c=null,function(v){for(var O=-1,U=p.length,H;++O<U;)f[(H=p[O]).i]=H.x(v);return f.join("")}}}var $a=vi(Ca,"px, ","px)","deg)"),Da=vi(Ua,", ",")",")"),za=1e-12;function Or(e){return((e=Math.exp(e))+1/e)/2}function Fa(e){return((e=Math.exp(e))-1/e)/2}function Ka(e){return((e=Math.exp(2*e))-1)/(e+1)}const Ha=function e(t,n,r){function i(o,s){var a=o[0],l=o[1],u=o[2],c=s[0],f=s[1],p=s[2],v=c-a,O=f-l,U=v*v+O*O,H,b;if(U<za)b=Math.log(p/u)/t,H=function(I){return[a+I*v,l+I*O,u*Math.exp(t*I*b)]};else{var B=Math.sqrt(U),y=(p*p-u*u+r*U)/(2*u*n*B),E=(p*p-u*u-r*U)/(2*p*n*B),M=Math.log(Math.sqrt(y*y+1)-y),T=Math.log(Math.sqrt(E*E+1)-E);b=(T-M)/t,H=function(I){var S=I*b,V=Or(M),ie=u/(n*B)*(V*Ka(t*S+M)-Fa(M));return[a+ie*v,l+ie*O,u*V/Or(t*S+M)]}}return H.duration=b*1e3*t/Math.SQRT2,H}return i.rho=function(o){var s=Math.max(.001,+o),a=s*s,l=a*a;return e(s,a,l)},i}(Math.SQRT2,2,4);var mt=0,bt=0,yt=0,yi=1e3,Zt,kt,Qt=0,st=0,un=0,At=typeof performance=="object"&&performance.now?performance:Date,wi=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Qn(){return st||(wi(Va),st=At.now()+un)}function Va(){st=0}function en(){this._call=this._time=this._next=null}en.prototype=bi.prototype={constructor:en,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Qn():+n)+(t==null?0:+t),!this._next&&kt!==this&&(kt?kt._next=this:Zt=this,kt=this),this._call=e,this._time=n,Cn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Cn())}};function bi(e,t,n){var r=new en;return r.restart(e,t,n),r}function Ba(){Qn(),++mt;for(var e=Zt,t;e;)(t=st-e._time)>=0&&e._call.call(void 0,t),e=e._next;--mt}function Ir(){st=(Qt=At.now())+un,mt=bt=0;try{Ba()}finally{mt=0,qa(),st=0}}function Xa(){var e=At.now(),t=e-Qt;t>yi&&(un-=t,Qt=e)}function qa(){for(var e,t=Zt,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Zt=n);kt=e,Cn(r)}function Cn(e){if(!mt){bt&&(bt=clearTimeout(bt));var t=e-st;t>24?(e<1/0&&(bt=setTimeout(Ir,e-At.now()-un)),yt&&(yt=clearInterval(yt))):(yt||(Qt=At.now(),yt=setInterval(Xa,yi)),mt=1,wi(Ir))}}function Sr(e,t,n){var r=new en;return t=t==null?0:+t,r.restart(i=>{r.stop(),e(i+t)},t,n),r}var Ya=Yn("start","end","cancel","interrupt"),Ga=[],ki=0,Ar=1,Un=2,Kt=3,Pr=4,$n=5,Ht=6;function cn(e,t,n,r,i,o){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;ja(e,n,{name:t,index:r,group:i,on:Ya,tween:Ga,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:ki})}function er(e,t){var n=Te(e,t);if(n.state>ki)throw new Error("too late; already scheduled");return n}function $e(e,t){var n=Te(e,t);if(n.state>Kt)throw new Error("too late; already running");return n}function Te(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function ja(e,t,n){var r=e.__transition,i;r[t]=n,n.timer=bi(o,0,n.time);function o(u){n.state=Ar,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var c,f,p,v;if(n.state!==Ar)return l();for(c in r)if(v=r[c],v.name===n.name){if(v.state===Kt)return Sr(s);v.state===Pr?(v.state=Ht,v.timer.stop(),v.on.call("interrupt",e,e.__data__,v.index,v.group),delete r[c]):+c<t&&(v.state=Ht,v.timer.stop(),v.on.call("cancel",e,e.__data__,v.index,v.group),delete r[c])}if(Sr(function(){n.state===Kt&&(n.state=Pr,n.timer.restart(a,n.delay,n.time),a(u))}),n.state=Un,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Un){for(n.state=Kt,i=new Array(p=n.tween.length),c=0,f=-1;c<p;++c)(v=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(i[++f]=v);i.length=f+1}}function a(u){for(var c=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=$n,1),f=-1,p=i.length;++f<p;)i[f].call(e,c);n.state===$n&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=Ht,n.timer.stop(),delete r[t];for(var u in r)return;delete e.__transition}}function Vt(e,t){var n=e.__transition,r,i,o=!0,s;if(!!n){t=t==null?null:t+"";for(s in n){if((r=n[s]).name!==t){o=!1;continue}i=r.state>Un&&r.state<$n,r.state=Ht,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]}o&&delete e.__transition}}function Ja(e){return this.each(function(){Vt(this,e)})}function Wa(e,t){var n,r;return function(){var i=$e(this,e),o=i.tween;if(o!==n){r=n=o;for(var s=0,a=r.length;s<a;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function Za(e,t,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=$e(this,e),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:t,value:n},l=0,u=i.length;l<u;++l)if(i[l].name===t){i[l]=a;break}l===u&&i.push(a)}o.tween=i}}function Qa(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=Te(this.node(),n).tween,i=0,o=r.length,s;i<o;++i)if((s=r[i]).name===e)return s.value;return null}return this.each((t==null?Wa:Za)(n,e,t))}function tr(e,t,n){var r=e._id;return e.each(function(){var i=$e(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return Te(i,r).value[t]}}function xi(e,t){var n;return(typeof t=="number"?ke:t instanceof ot?Wt:(n=ot(t))?(t=n,Wt):_i)(e,t)}function el(e){return function(){this.removeAttribute(e)}}function tl(e){return function(){this.removeAttributeNS(e.space,e.local)}}function nl(e,t,n){var r,i=n+"",o;return function(){var s=this.getAttribute(e);return s===i?null:s===r?o:o=t(r=s,n)}}function rl(e,t,n){var r,i=n+"",o;return function(){var s=this.getAttributeNS(e.space,e.local);return s===i?null:s===r?o:o=t(r=s,n)}}function il(e,t,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a)))}}function ol(e,t,n){var r,i,o;return function(){var s,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),l=a+"",s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a)))}}function sl(e,t){var n=ln(e),r=n==="transform"?Da:xi;return this.attrTween(e,typeof t=="function"?(n.local?ol:il)(n,r,tr(this,"attr."+e,t)):t==null?(n.local?tl:el)(n):(n.local?rl:nl)(n,r,t))}function al(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function ll(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ul(e,t){var n,r;function i(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&ll(e,o)),n}return i._value=t,i}function cl(e,t){var n,r;function i(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&al(e,o)),n}return i._value=t,i}function fl(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=ln(e);return this.tween(n,(r.local?ul:cl)(r,t))}function hl(e,t){return function(){er(this,e).delay=+t.apply(this,arguments)}}function dl(e,t){return t=+t,function(){er(this,e).delay=t}}function pl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?hl:dl)(t,e)):Te(this.node(),t).delay}function ml(e,t){return function(){$e(this,e).duration=+t.apply(this,arguments)}}function _l(e,t){return t=+t,function(){$e(this,e).duration=t}}function gl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ml:_l)(t,e)):Te(this.node(),t).duration}function vl(e,t){if(typeof t!="function")throw new Error;return function(){$e(this,e).ease=t}}function yl(e){var t=this._id;return arguments.length?this.each(vl(t,e)):Te(this.node(),t).ease}function wl(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;$e(this,e).ease=n}}function bl(e){if(typeof e!="function")throw new Error;return this.each(wl(this._id,e))}function kl(e){typeof e!="function"&&(e=ri(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o=t[i],s=o.length,a=r[i]=[],l,u=0;u<s;++u)(l=o[u])&&e.call(l,l.__data__,u,o)&&a.push(l);return new Ke(r,this._parents,this._name,this._id)}function xl(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var l=t[a],u=n[a],c=l.length,f=s[a]=new Array(c),p,v=0;v<c;++v)(p=l[v]||u[v])&&(f[v]=p);for(;a<r;++a)s[a]=t[a];return new Ke(s,this._parents,this._name,this._id)}function El(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Ol(e,t,n){var r,i,o=El(t)?er:$e;return function(){var s=o(this,e),a=s.on;a!==r&&(i=(r=a).copy()).on(t,n),s.on=i}}function Il(e,t){var n=this._id;return arguments.length<2?Te(this.node(),n).on.on(e):this.each(Ol(n,e,t))}function Sl(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Al(){return this.on("end.remove",Sl(this._id))}function Pl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Gn(e));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a=r[s],l=a.length,u=o[s]=new Array(l),c,f,p=0;p<l;++p)(c=a[p])&&(f=e.call(c,c.__data__,p,a))&&("__data__"in c&&(f.__data__=c.__data__),u[p]=f,cn(u[p],t,n,p,u,Te(c,n)));return new Ke(o,this._parents,t,n)}function Tl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ni(e));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var l=r[a],u=l.length,c,f=0;f<u;++f)if(c=l[f]){for(var p=e.call(c,c.__data__,f,l),v,O=Te(c,n),U=0,H=p.length;U<H;++U)(v=p[U])&&cn(v,t,n,U,p,O);o.push(p),s.push(c)}return new Ke(o,s,t,n)}var Nl=Tt.prototype.constructor;function Ml(){return new Nl(this._groups,this._parents)}function Ll(e,t){var n,r,i;return function(){var o=pt(this,e),s=(this.style.removeProperty(e),pt(this,e));return o===s?null:o===n&&s===r?i:i=t(n=o,r=s)}}function Ei(e){return function(){this.style.removeProperty(e)}}function Rl(e,t,n){var r,i=n+"",o;return function(){var s=pt(this,e);return s===i?null:s===r?o:o=t(r=s,n)}}function Cl(e,t,n){var r,i,o;return function(){var s=pt(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),pt(this,e))),s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a))}}function Ul(e,t){var n,r,i,o="style."+t,s="end."+o,a;return function(){var l=$e(this,e),u=l.on,c=l.value[o]==null?a||(a=Ei(t)):void 0;(u!==n||i!==c)&&(r=(n=u).copy()).on(s,i=c),l.on=r}}function $l(e,t,n){var r=(e+="")=="transform"?$a:xi;return t==null?this.styleTween(e,Ll(e,r)).on("end.style."+e,Ei(e)):typeof t=="function"?this.styleTween(e,Cl(e,r,tr(this,"style."+e,t))).each(Ul(this._id,e)):this.styleTween(e,Rl(e,r,t),n).on("end.style."+e,null)}function Dl(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function zl(e,t,n){var r,i;function o(){var s=t.apply(this,arguments);return s!==i&&(r=(i=s)&&Dl(e,s,n)),r}return o._value=t,o}function Fl(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,zl(e,t,n==null?"":n))}function Kl(e){return function(){this.textContent=e}}function Hl(e){return function(){var t=e(this);this.textContent=t==null?"":t}}function Vl(e){return this.tween("text",typeof e=="function"?Hl(tr(this,"text",e)):Kl(e==null?"":e+""))}function Bl(e){return function(t){this.textContent=e.call(this,t)}}function Xl(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&Bl(i)),t}return r._value=e,r}function ql(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Xl(e))}function Yl(){for(var e=this._name,t=this._id,n=Oi(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,u=0;u<a;++u)if(l=s[u]){var c=Te(l,t);cn(l,e,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Ke(r,this._parents,e,n)}function Gl(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--i===0&&o()}};n.each(function(){var u=$e(this,r),c=u.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),u.on=t}),i===0&&o()})}var jl=0;function Ke(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function Oi(){return++jl}var De=Tt.prototype;Ke.prototype={constructor:Ke,select:Pl,selectAll:Tl,selectChild:De.selectChild,selectChildren:De.selectChildren,filter:kl,merge:xl,selection:Ml,transition:Yl,call:De.call,nodes:De.nodes,node:De.node,size:De.size,empty:De.empty,each:De.each,on:Il,attr:sl,attrTween:fl,style:$l,styleTween:Fl,text:Vl,textTween:ql,remove:Al,tween:Qa,delay:pl,duration:gl,ease:yl,easeVarying:bl,end:Gl,[Symbol.iterator]:De[Symbol.iterator]};function Jl(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Wl={time:null,delay:0,duration:250,ease:Jl};function Zl(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Ql(e){var t,n;e instanceof Ke?(t=e._id,e=e._name):(t=Oi(),(n=Wl).time=Qn(),e=e==null?null:e+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s=r[o],a=s.length,l,u=0;u<a;++u)(l=s[u])&&cn(l,e,t,u,s,n||Zl(l,t));return new Ke(r,this._parents,e,t)}Tt.prototype.interrupt=Ja;Tt.prototype.transition=Ql;const Ut=e=>()=>e;function eu(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Fe(e,t,n){this.k=e,this.x=t,this.y=n}Fe.prototype={constructor:Fe,scale:function(e){return e===1?this:new Fe(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Fe(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var nr=new Fe(1,0,0);Fe.prototype;function wn(e){e.stopImmediatePropagation()}function wt(e){e.preventDefault(),e.stopImmediatePropagation()}function tu(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function nu(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Tr(){return this.__zoom||nr}function ru(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function iu(){return navigator.maxTouchPoints||"ontouchstart"in this}function ou(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function su(){var e=tu,t=nu,n=ou,r=ru,i=iu,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Ha,u=Yn("start","zoom","end"),c,f,p,v=500,O=150,U=0,H=10;function b(d){d.property("__zoom",Tr).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",V).on("dblclick.zoom",ie).filter(i).on("touchstart.zoom",g).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",Y).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}b.transform=function(d,x,_,A){var C=d.selection?d.selection():d;C.property("__zoom",Tr),d!==C?M(d,x,_,A):C.interrupt().each(function(){T(this,arguments).event(A).start().zoom(null,typeof x=="function"?x.apply(this,arguments):x).end()})},b.scaleBy=function(d,x,_,A){b.scaleTo(d,function(){var C=this.__zoom.k,R=typeof x=="function"?x.apply(this,arguments):x;return C*R},_,A)},b.scaleTo=function(d,x,_,A){b.transform(d,function(){var C=t.apply(this,arguments),R=this.__zoom,z=_==null?E(C):typeof _=="function"?_.apply(this,arguments):_,G=R.invert(z),Z=typeof x=="function"?x.apply(this,arguments):x;return n(y(B(R,Z),z,G),C,s)},_,A)},b.translateBy=function(d,x,_,A){b.transform(d,function(){return n(this.__zoom.translate(typeof x=="function"?x.apply(this,arguments):x,typeof _=="function"?_.apply(this,arguments):_),t.apply(this,arguments),s)},null,A)},b.translateTo=function(d,x,_,A,C){b.transform(d,function(){var R=t.apply(this,arguments),z=this.__zoom,G=A==null?E(R):typeof A=="function"?A.apply(this,arguments):A;return n(nr.translate(G[0],G[1]).scale(z.k).translate(typeof x=="function"?-x.apply(this,arguments):-x,typeof _=="function"?-_.apply(this,arguments):-_),R,s)},A,C)};function B(d,x){return x=Math.max(o[0],Math.min(o[1],x)),x===d.k?d:new Fe(x,d.x,d.y)}function y(d,x,_){var A=x[0]-_[0]*d.k,C=x[1]-_[1]*d.k;return A===d.x&&C===d.y?d:new Fe(d.k,A,C)}function E(d){return[(+d[0][0]+ +d[1][0])/2,(+d[0][1]+ +d[1][1])/2]}function M(d,x,_,A){d.on("start.zoom",function(){T(this,arguments).event(A).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(A).end()}).tween("zoom",function(){var C=this,R=arguments,z=T(C,R).event(A),G=t.apply(C,R),Z=_==null?E(G):typeof _=="function"?_.apply(C,R):_,de=Math.max(G[1][0]-G[0][0],G[1][1]-G[0][1]),se=C.__zoom,me=typeof x=="function"?x.apply(C,R):x,ye=l(se.invert(Z).concat(de/se.k),me.invert(Z).concat(de/me.k));return function(_e){if(_e===1)_e=me;else{var ae=ye(_e),vt=de/ae[2];_e=new Fe(vt,Z[0]-ae[0]*vt,Z[1]-ae[1]*vt)}z.zoom(null,_e)}})}function T(d,x,_){return!_&&d.__zooming||new I(d,x)}function I(d,x){this.that=d,this.args=x,this.active=0,this.sourceEvent=null,this.extent=t.apply(d,x),this.taps=0}I.prototype={event:function(d){return d&&(this.sourceEvent=d),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(d,x){return this.mouse&&d!=="mouse"&&(this.mouse[1]=x.invert(this.mouse[0])),this.touch0&&d!=="touch"&&(this.touch0[1]=x.invert(this.touch0[0])),this.touch1&&d!=="touch"&&(this.touch1[1]=x.invert(this.touch1[0])),this.that.__zoom=x,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(d){var x=Ve(this.that).datum();u.call(d,this.that,new eu(d,{sourceEvent:this.sourceEvent,target:b,type:d,transform:this.that.__zoom,dispatch:u}),x)}};function S(d,...x){if(!e.apply(this,arguments))return;var _=T(this,x).event(d),A=this.__zoom,C=Math.max(o[0],Math.min(o[1],A.k*Math.pow(2,r.apply(this,arguments)))),R=Qe(d);if(_.wheel)(_.mouse[0][0]!==R[0]||_.mouse[0][1]!==R[1])&&(_.mouse[1]=A.invert(_.mouse[0]=R)),clearTimeout(_.wheel);else{if(A.k===C)return;_.mouse=[R,A.invert(R)],Vt(this),_.start()}wt(d),_.wheel=setTimeout(z,O),_.zoom("mouse",n(y(B(A,C),_.mouse[0],_.mouse[1]),_.extent,s));function z(){_.wheel=null,_.end()}}function V(d,...x){if(p||!e.apply(this,arguments))return;var _=d.currentTarget,A=T(this,x,!0).event(d),C=Ve(d.view).on("mousemove.zoom",Z,!0).on("mouseup.zoom",de,!0),R=Qe(d,_),z=d.clientX,G=d.clientY;ca(d.view),wn(d),A.mouse=[R,this.__zoom.invert(R)],Vt(this),A.start();function Z(se){if(wt(se),!A.moved){var me=se.clientX-z,ye=se.clientY-G;A.moved=me*me+ye*ye>U}A.event(se).zoom("mouse",n(y(A.that.__zoom,A.mouse[0]=Qe(se,_),A.mouse[1]),A.extent,s))}function de(se){C.on("mousemove.zoom mouseup.zoom",null),fa(se.view,A.moved),wt(se),A.event(se).end()}}function ie(d,...x){if(!!e.apply(this,arguments)){var _=this.__zoom,A=Qe(d.changedTouches?d.changedTouches[0]:d,this),C=_.invert(A),R=_.k*(d.shiftKey?.5:2),z=n(y(B(_,R),A,C),t.apply(this,x),s);wt(d),a>0?Ve(this).transition().duration(a).call(M,z,A,d):Ve(this).call(b.transform,z,A,d)}}function g(d,...x){if(!!e.apply(this,arguments)){var _=d.touches,A=_.length,C=T(this,x,d.changedTouches.length===A).event(d),R,z,G,Z;for(wn(d),z=0;z<A;++z)G=_[z],Z=Qe(G,this),Z=[Z,this.__zoom.invert(Z),G.identifier],C.touch0?!C.touch1&&C.touch0[2]!==Z[2]&&(C.touch1=Z,C.taps=0):(C.touch0=Z,R=!0,C.taps=1+!!c);c&&(c=clearTimeout(c)),R&&(C.taps<2&&(f=Z[0],c=setTimeout(function(){c=null},v)),Vt(this),C.start())}}function F(d,...x){if(!!this.__zooming){var _=T(this,x).event(d),A=d.changedTouches,C=A.length,R,z,G,Z;for(wt(d),R=0;R<C;++R)z=A[R],G=Qe(z,this),_.touch0&&_.touch0[2]===z.identifier?_.touch0[0]=G:_.touch1&&_.touch1[2]===z.identifier&&(_.touch1[0]=G);if(z=_.that.__zoom,_.touch1){var de=_.touch0[0],se=_.touch0[1],me=_.touch1[0],ye=_.touch1[1],_e=(_e=me[0]-de[0])*_e+(_e=me[1]-de[1])*_e,ae=(ae=ye[0]-se[0])*ae+(ae=ye[1]-se[1])*ae;z=B(z,Math.sqrt(_e/ae)),G=[(de[0]+me[0])/2,(de[1]+me[1])/2],Z=[(se[0]+ye[0])/2,(se[1]+ye[1])/2]}else if(_.touch0)G=_.touch0[0],Z=_.touch0[1];else return;_.zoom("touch",n(y(z,G,Z),_.extent,s))}}function Y(d,...x){if(!!this.__zooming){var _=T(this,x).event(d),A=d.changedTouches,C=A.length,R,z;for(wn(d),p&&clearTimeout(p),p=setTimeout(function(){p=null},v),R=0;R<C;++R)z=A[R],_.touch0&&_.touch0[2]===z.identifier?delete _.touch0:_.touch1&&_.touch1[2]===z.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(z=Qe(z,this),Math.hypot(f[0]-z[0],f[1]-z[1])<H)){var G=Ve(this).on("dblclick.zoom");G&&G.apply(this,arguments)}}}return b.wheelDelta=function(d){return arguments.length?(r=typeof d=="function"?d:Ut(+d),b):r},b.filter=function(d){return arguments.length?(e=typeof d=="function"?d:Ut(!!d),b):e},b.touchable=function(d){return arguments.length?(i=typeof d=="function"?d:Ut(!!d),b):i},b.extent=function(d){return arguments.length?(t=typeof d=="function"?d:Ut([[+d[0][0],+d[0][1]],[+d[1][0],+d[1][1]]]),b):t},b.scaleExtent=function(d){return arguments.length?(o[0]=+d[0],o[1]=+d[1],b):[o[0],o[1]]},b.translateExtent=function(d){return arguments.length?(s[0][0]=+d[0][0],s[1][0]=+d[1][0],s[0][1]=+d[0][1],s[1][1]=+d[1][1],b):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},b.constrain=function(d){return arguments.length?(n=d,b):n},b.duration=function(d){return arguments.length?(a=+d,b):a},b.interpolate=function(d){return arguments.length?(l=d,b):l},b.on=function(){var d=u.on.apply(u,arguments);return d===u?b:d},b.clickDistance=function(d){return arguments.length?(U=(d=+d)*d,b):Math.sqrt(U)},b.tapDistance=function(d){return arguments.length?(H=+d,b):H},b}const we=Ue(""),lt=Ue(!1),Ot=Ue(!1),Dn=Ue(),zn=Ue(!1),Fn=Ue(!1),Kn=Ue(nr),rt=Ue(null),Pt=Ue(null),tn=Ue(null);function au(e){rt.set(e.getPresence()),Pt.set(e.getOthers());const t=e.subscribe("my-presence",r=>{rt.update(i=>r)}),n=e.subscribe("others",r=>{Pt.update(i=>r)});return rt.set=r=>(e.updatePresence(r),r),()=>{t(),n()}}async function lu(e){try{const{root:t}=await e.getStorage(),n=t.get("imagesList");tn.set(n),e.subscribe(n,()=>{tn.update(r=>n)})}catch(t){console.log(t)}}const uu="PROD",cu="wss://spaces.huggingface.tech/huggingface-projects/sd-color-palette-generator/queue/join";var fu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ne={},$={};Object.defineProperty($,"__esModule",{value:!0});var hu=Object.defineProperty,du=Object.defineProperties,pu=Object.getOwnPropertyDescriptors,nn=Object.getOwnPropertySymbols,Ii=Object.prototype.hasOwnProperty,Si=Object.prototype.propertyIsEnumerable,Nr=(e,t,n)=>t in e?hu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mt=(e,t)=>{for(var n in t||(t={}))Ii.call(t,n)&&Nr(e,n,t[n]);if(nn)for(var n of nn(t))Si.call(t,n)&&Nr(e,n,t[n]);return e},fn=(e,t)=>du(e,pu(t)),mu=(e,t)=>{var n={};for(var r in e)Ii.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&nn)for(var r of nn(e))t.indexOf(r)<0&&Si.call(e,r)&&(n[r]=e[r]);return n},_u=(e,t,n)=>new Promise((r,i)=>{var o=l=>{try{a(n.next(l))}catch(u){i(u)}},s=l=>{try{a(n.throw(l))}catch(u){i(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,s);a((n=n.apply(e,t)).next())});function gu(e,t=e){}function vu(e,t,n=t){}function yu(e){}function wu(e,t){}function Be(e,t){throw new Error(t)}function X(e,t="Expected value to be non-nullable"){return e}var Ai=(e=>(e[e.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",e[e.BROADCAST_EVENT=103]="BROADCAST_EVENT",e[e.FETCH_STORAGE=200]="FETCH_STORAGE",e[e.UPDATE_STORAGE=201]="UPDATE_STORAGE",e))(Ai||{}),Pi=(e=>(e[e.INIT=0]="INIT",e[e.SET_PARENT_KEY=1]="SET_PARENT_KEY",e[e.CREATE_LIST=2]="CREATE_LIST",e[e.UPDATE_OBJECT=3]="UPDATE_OBJECT",e[e.CREATE_OBJECT=4]="CREATE_OBJECT",e[e.DELETE_CRDT=5]="DELETE_CRDT",e[e.DELETE_OBJECT_KEY=6]="DELETE_OBJECT_KEY",e[e.CREATE_MAP=7]="CREATE_MAP",e[e.CREATE_REGISTER=8]="CREATE_REGISTER",e))(Pi||{}),Ti=(e=>(e[e.OBJECT=0]="OBJECT",e[e.LIST=1]="LIST",e[e.MAP=2]="MAP",e[e.REGISTER=3]="REGISTER",e))(Ti||{});function bu(e){return e.type===0&&!Ni(e)}function Ni(e){return e.parentId!==void 0&&e.parentKey!==void 0}var Mi=(e=>(e[e.UPDATE_PRESENCE=100]="UPDATE_PRESENCE",e[e.USER_JOINED=101]="USER_JOINED",e[e.USER_LEFT=102]="USER_LEFT",e[e.BROADCASTED_EVENT=103]="BROADCASTED_EVENT",e[e.ROOM_STATE=104]="ROOM_STATE",e[e.INITIAL_STORAGE_STATE=200]="INITIAL_STORAGE_STATE",e[e.UPDATE_STORAGE=201]="UPDATE_STORAGE",e))(Mi||{});function ku(e){return e==="my-presence"||e==="others"||e==="event"||e==="error"||e==="connection"||e==="history"}var Li=(e=>(e[e.CLOSE_ABNORMAL=1006]="CLOSE_ABNORMAL",e[e.INVALID_MESSAGE_FORMAT=4e3]="INVALID_MESSAGE_FORMAT",e[e.NOT_ALLOWED=4001]="NOT_ALLOWED",e[e.MAX_NUMBER_OF_MESSAGES_PER_SECONDS=4002]="MAX_NUMBER_OF_MESSAGES_PER_SECONDS",e[e.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS=4003]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS",e[e.MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP=4004]="MAX_NUMBER_OF_MESSAGES_PER_DAY_PER_APP",e[e.MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM=4005]="MAX_NUMBER_OF_CONCURRENT_CONNECTIONS_PER_ROOM",e[e.CLOSE_WITHOUT_RETRY=4999]="CLOSE_WITHOUT_RETRY",e))(Li||{}),at=32,rr=126;function Le(e,t){return e!==void 0&&t!==void 0?rn(Ri(_t(e),_t(t))):e!==void 0?Eu(e):t!==void 0?xu(t):rn([at+1])}function xu(e){const t=[],n=_t(e);for(let r=0;r<n.length;r++){const i=n[r];if(i<=at+1){if(t.push(at),n.length-1===r){t.push(rr);break}}else{t.push(i-1);break}}return rn(t)}function Eu(e){const t=[],n=_t(e);for(let r=0;r<n.length;r++){const i=n[r];if(i===rr){if(t.push(i),n.length-1===r){t.push(at+1);break}}else{t.push(i+1);break}}return rn(t)}function Ri(e,t){let n=0;const r=[];for(;;){const i=e[n]||at,o=t[n]||rr;if(i>o)throw new Error(`Impossible to generate position between ${e} and ${t}`);if(i===o){r.push(i),n++;continue}if(o-i===1){r.push(i),r.push(...Ri(e.slice(n+1),[]));break}const s=o+i>>1;r.push(s);break}return r}function _t(e){const t=[];for(let n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}function rn(e){return String.fromCharCode(...e)}function Ci(e,t){const n=_t(e),r=_t(t),i=Math.max(n.length,r.length);for(let o=0;o<i;o++){const s=n[o]===void 0?at:n[o],a=r[o]===void 0?at:r[o];if(s!==a)return s-a}throw new Error(`Impossible to compare similar position "${e}" and "${t}"`)}function Mr(e,t){return Object.freeze({type:"HasParent",node:e,key:t})}var Lr=Object.freeze({type:"NoParent"});function Rr(e){return Object.freeze({type:"Orphaned",oldKey:e})}var hn=class{constructor(){this._parent=Lr}_getParentKeyOrThrow(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":throw new Error("Parent key is missing");case"Orphaned":return this.parent.oldKey;default:return Be(this.parent,"Unknown state")}}get _pool(){return this.__pool}get roomId(){return this.__pool?this.__pool.roomId:null}get _id(){return this.__id}get parent(){return this._parent}get _parentNode(){switch(this.parent.type){case"HasParent":return this.parent.node;case"NoParent":return null;case"Orphaned":return null;default:return Be(this.parent,"Unknown state")}}get _parentKey(){switch(this.parent.type){case"HasParent":return this.parent.key;case"NoParent":return null;case"Orphaned":return this.parent.oldKey;default:return Be(this.parent,"Unknown state")}}_apply(e,t){switch(e.type){case 5:return this.parent.type==="HasParent"?this.parent.node._detachChild(this):{modified:!1}}return{modified:!1}}_setParentLink(e,t){switch(this.parent.type){case"HasParent":if(this.parent.node!==e)throw new Error("Cannot set parent: node already has a parent");this._parent=Mr(e,t);return;case"Orphaned":case"NoParent":{this._parent=Mr(e,t);return}default:return Be(this.parent,"Unknown state")}}_attach(e,t){if(this.__id||this.__pool)throw new Error("Cannot attach node: already attached");t.addNode(e,this),this.__id=e,this.__pool=t}_detach(){switch(this.__pool&&this.__id&&this.__pool.deleteNode(this.__id),this.parent.type){case"HasParent":{this._parent=Rr(this.parent.key);break}case"NoParent":{this._parent=Lr;break}case"Orphaned":{this._parent=Rr(this.parent.oldKey);break}default:Be(this.parent,"Unknown state")}this.__pool=void 0}invalidate(){this._cachedImmutable!==void 0&&(this._cachedImmutable=void 0,this.parent.type==="HasParent"&&this.parent.node.invalidate())}toImmutable(){return this._cachedImmutable===void 0&&(this._cachedImmutable=this._toImmutable()),this._cachedImmutable}},He=class extends hn{constructor(e){super(),this._data=e}get data(){return this._data}static _deserialize([e,t],n,r){const i=new He(t.data);return i._attach(e,r),i}_toOps(e,t,n){if(this._id===void 0)throw new Error("Cannot serialize register if parentId or parentKey is undefined");return[{type:8,opId:n==null?void 0:n.generateOpId(),id:this._id,parentId:e,parentKey:t,data:this.data}]}_serialize(){if(this.parent.type!=="HasParent")throw new Error("Cannot serialize LiveRegister if parent is missing");return{type:3,parentId:X(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key,data:this.data}}_attachChild(e){throw new Error("Method not implemented.")}_detachChild(e){throw new Error("Method not implemented.")}_apply(e,t){return super._apply(e,t)}_toImmutable(){return this._data}},Je=class extends hn{constructor(e){if(super(),this.unacknowledgedSet=new Map,e){const t=[];for(const n of e){const r=dt(n[1]);r._setParentLink(this,n[0]),t.push([n[0],r])}this._map=new Map(t)}else this._map=new Map}_toOps(e,t,n){if(this._id===void 0)throw new Error("Cannot serialize item is not attached");const r=[],i={id:this._id,opId:n==null?void 0:n.generateOpId(),type:7,parentId:e,parentKey:t};r.push(i);for(const[o,s]of this._map)r.push(...s._toOps(this._id,o,n));return r}static _deserialize([e,t],n,r){const i=new Je;i._attach(e,r);const o=n.get(e);if(o===void 0)return i;for(const[s,a]of o){const l=Di([s,a],n,r);l._setParentLink(i,a.parentKey),i._map.set(a.parentKey,l),i.invalidate()}return i}_attach(e,t){super._attach(e,t);for(const[n,r]of this._map)fe(r)&&r._attach(t.generateId(),t)}_attachChild(e,t){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const{id:n,parentKey:r,opId:i}=e,o=r,s=xt(e);if(this._pool.getNode(n)!==void 0)return{modified:!1};if(t===2){const u=this.unacknowledgedSet.get(o);if(u===i)return this.unacknowledgedSet.delete(o),{modified:!1};if(u!==void 0)return{modified:!1}}else t===1&&this.unacknowledgedSet.delete(o);const a=this._map.get(o);let l;if(a){const u=X(this._id);l=a._toOps(u,o),a._detach()}else l=[{type:5,id:n}];return s._setParentLink(this,o),s._attach(n,this._pool),this._map.set(o,s),this.invalidate(),{modified:{node:this,type:"LiveMap",updates:{[o]:{type:"update"}}},reverse:l}}_detach(){super._detach();for(const e of this._map.values())e._detach()}_detachChild(e){const t=X(this._id),n=X(e._parentKey),r=e._toOps(t,n,this._pool);for(const[o,s]of this._map)s===e&&(this._map.delete(o),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveMap",updates:{[n]:{type:"delete"}}},reverse:r}}_serialize(){if(this.parent.type!=="HasParent")throw new Error("Cannot serialize LiveMap if parent is missing");return{type:2,parentId:X(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get(e){const t=this._map.get(e);if(t!==void 0)return it(t)}set(e,t){const n=this._map.get(e);n&&n._detach();const r=dt(t);if(r._setParentLink(this,e),this._map.set(e,r),this.invalidate(),this._pool&&this._id){const i=this._pool.generateId();r._attach(i,this._pool);const o=new Map;o.set(this._id,{node:this,type:"LiveMap",updates:{[e]:{type:"update"}}});const s=r._toOps(this._id,e,this._pool);this.unacknowledgedSet.set(e,X(s[0].opId)),this._pool.dispatch(r._toOps(this._id,e,this._pool),n?n._toOps(this._id,e):[{type:5,id:i}],o)}}get size(){return this._map.size}has(e){return this._map.has(e)}delete(e){const t=this._map.get(e);if(t===void 0)return!1;if(t._detach(),this._map.delete(e),this.invalidate(),this._pool&&t._id){const n=X(this._id),r=new Map;r.set(n,{node:this,type:"LiveMap",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:5,id:t._id,opId:this._pool.generateOpId()}],t._toOps(n,e),r)}return!0}entries(){const e=this._map.entries();return{[Symbol.iterator](){return this},next(){const t=e.next();if(t.done)return{done:!0,value:void 0};const r=t.value[0],i=it(t.value[1]);return{value:[r,i]}}}}[Symbol.iterator](){return this.entries()}keys(){return this._map.keys()}values(){const e=this._map.values();return{[Symbol.iterator](){return this},next(){const t=e.next();return t.done?{done:!0,value:void 0}:{value:it(t.value)}}}}forEach(e){for(const t of this)e(t[1],t[0],this)}toImmutable(){return super.toImmutable()}_toImmutable(){const e=new Map;for(const[t,n]of this._map)e.set(t,n.toImmutable());return ir(e)}},We=class extends hn{constructor(e={}){super(),this._propToLastUpdate=new Map;for(const t in e){const n=e[t];n!==void 0&&fe(n)&&n._setParentLink(this,t)}this._map=new Map(Object.entries(e))}_toOps(e,t,n){if(this._id===void 0)throw new Error("Cannot serialize item is not attached");const r=n==null?void 0:n.generateOpId(),i=[],o=e!==void 0&&t!==void 0?{type:4,id:this._id,opId:r,parentId:e,parentKey:t,data:{}}:{type:4,id:this._id,opId:r,data:{}};i.push(o);for(const[s,a]of this._map)fe(a)?i.push(...a._toOps(this._id,s,n)):o.data[s]=a;return i}static _deserialize([e,t],n,r){const i=new We(t.data);return i._attach(e,r),this._deserializeChildren(i,n,r)}static _deserializeChildren(e,t,n){const r=t.get(X(e._id));if(r===void 0)return e;for(const[i,o]of r){const s=Su([i,o],t,n);Bt(s)&&s._setParentLink(e,o.parentKey),e._map.set(o.parentKey,s),e.invalidate()}return e}_attach(e,t){super._attach(e,t);for(const[n,r]of this._map)fe(r)&&r._attach(t.generateId(),t)}_attachChild(e,t){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const{id:n,opId:r,parentKey:i}=e,o=Ui(e);if(this._pool.getNode(n)!==void 0)return this._propToLastUpdate.get(i)===r&&this._propToLastUpdate.delete(i),{modified:!1};if(t===0)this._propToLastUpdate.set(i,X(r));else if(this._propToLastUpdate.get(i)!==void 0)return this._propToLastUpdate.get(i)===r?(this._propToLastUpdate.delete(i),{modified:!1}):{modified:!1};const s=X(this._id),a=this._map.get(i);let l;return fe(a)?(l=a._toOps(s,i),a._detach()):a===void 0?l=[{type:6,id:s,key:i}]:l=[{type:3,id:s,data:{[i]:a}}],this._map.set(i,o),this.invalidate(),Bt(o)&&(o._setParentLink(this,i),o._attach(n,this._pool)),{reverse:l,modified:{node:this,type:"LiveObject",updates:{[i]:{type:"update"}}}}}_detachChild(e){if(e){const t=X(this._id),n=X(e._parentKey),r=e._toOps(t,n,this._pool);for(const[o,s]of this._map)s===e&&(this._map.delete(o),this.invalidate());return e._detach(),{modified:{node:this,type:"LiveObject",updates:{[n]:{type:"delete"}}},reverse:r}}return{modified:!1}}_detach(){super._detach();for(const e of this._map.values())fe(e)&&e._detach()}_apply(e,t){return e.type===3?this._applyUpdate(e,t):e.type===6?this._applyDeleteObjectKey(e):super._apply(e,t)}_serialize(){const e={};for(const[t,n]of this._map)fe(n)||(e[t]=n);return this.parent.type==="HasParent"&&this.parent.node._id?{type:0,parentId:this.parent.node._id,parentKey:this.parent.key,data:e}:{type:0,data:e}}_applyUpdate(e,t){let n=!1;const r=X(this._id),i=[],o={type:3,id:r,data:{}};i.push(o);for(const a in e.data){const l=this._map.get(a);fe(l)?(i.push(...l._toOps(r,a)),l._detach()):l!==void 0?o.data[a]=l:l===void 0&&i.push({type:6,id:r,key:a})}const s={};for(const a in e.data){const l=e.data[a];if(l===void 0)continue;if(t)this._propToLastUpdate.set(a,X(e.opId));else if(this._propToLastUpdate.get(a)===void 0)n=!0;else if(this._propToLastUpdate.get(a)===e.opId){this._propToLastUpdate.delete(a);continue}else continue;const u=this._map.get(a);fe(u)&&u._detach(),n=!0,s[a]={type:"update"},this._map.set(a,l),this.invalidate()}return Object.keys(o.data).length!==0&&i.unshift(o),n?{modified:{node:this,type:"LiveObject",updates:s},reverse:i}:{modified:!1}}_applyDeleteObjectKey(e){const t=e.key;if(this._map.has(t)===!1)return{modified:!1};if(this._propToLastUpdate.get(t)!==void 0)return{modified:!1};const n=this._map.get(t),r=X(this._id);let i=[];return fe(n)?(i=n._toOps(r,e.key),n._detach()):n!==void 0&&(i=[{type:3,id:r,data:{[t]:n}}]),this._map.delete(t),this.invalidate(),{modified:{node:this,type:"LiveObject",updates:{[e.key]:{type:"delete"}}},reverse:i}}toObject(){return Cu(this._map)}set(e,t){this.update({[e]:t})}get(e){return this._map.get(e)}delete(e){const t=e,n=this._map.get(t);if(n===void 0)return;if(this._pool===void 0||this._id===void 0){fe(n)&&n._detach(),this._map.delete(t),this.invalidate();return}let r;fe(n)?(n._detach(),r=n._toOps(this._id,t)):r=[{type:3,data:{[t]:n},id:this._id}],this._map.delete(t),this.invalidate();const i=new Map;i.set(this._id,{node:this,type:"LiveObject",updates:{[e]:{type:"delete"}}}),this._pool.dispatch([{type:6,key:t,id:this._id,opId:this._pool.generateOpId()}],r,i)}update(e){if(this._pool===void 0||this._id===void 0){for(const l in e){const u=e[l];if(u===void 0)continue;const c=this._map.get(l);fe(c)&&c._detach(),fe(u)&&u._setParentLink(this,l),this._map.set(l,u),this.invalidate()}return}const t=[],n=[],r=this._pool.generateOpId(),i={},o={id:this._id,type:3,data:{}},s={};for(const l in e){const u=e[l];if(u===void 0)continue;const c=this._map.get(l);if(fe(c)?(n.push(...c._toOps(this._id,l)),c._detach()):c===void 0?n.push({type:6,id:this._id,key:l}):o.data[l]=c,fe(u)){u._setParentLink(this,l),u._attach(this._pool.generateId(),this._pool);const f=u._toOps(this._id,l,this._pool),p=f.find(v=>v.parentId===this._id);p&&this._propToLastUpdate.set(l,X(p.opId)),t.push(...f)}else i[l]=u,this._propToLastUpdate.set(l,r);this._map.set(l,u),this.invalidate(),s[l]={type:"update"}}Object.keys(o.data).length!==0&&n.unshift(o),Object.keys(i).length!==0&&t.unshift({opId:r,id:this._id,type:3,data:i});const a=new Map;a.set(this._id,{node:this,type:"LiveObject",updates:s}),this._pool.dispatch(t,n,a)}toImmutable(){return super.toImmutable()}_toImmutable(){const e={};for(const[t,n]of this._map)e[t]=Bt(n)?n.toImmutable():n;return e}},ir=e=>e;function Ou(e){return e.filter(t=>t!=null)}function Iu(e){const t=Mt({},e);return Object.keys(e).forEach(n=>{const r=n;t[r]===void 0&&delete t[r]}),t}function xt(e){return dt(Ui(e))}function Ui(e){switch(e.type){case 8:return e.data;case 4:return new We(e.data);case 7:return new Je;case 2:return new Ze;default:return Be(e,"Unknown creation Op")}}function $i(e,t){return e===t?!0:e.parent.type==="HasParent"?$i(e.parent.node,t):!1}function Di([e,t],n,r){switch(t.type){case 0:return We._deserialize([e,t],n,r);case 1:return Ze._deserialize([e,t],n,r);case 2:return Je._deserialize([e,t],n,r);case 3:return He._deserialize([e,t],n,r);default:throw new Error("Unexpected CRDT type")}}function Su([e,t],n,r){switch(t.type){case 0:return We._deserialize([e,t],n,r);case 1:return Ze._deserialize([e,t],n,r);case 2:return Je._deserialize([e,t],n,r);case 3:return t.data;default:throw new Error("Unexpected CRDT type")}}function Bt(e){return zi(e)||Au(e)||Fi(e)}function fe(e){return Bt(e)||Pu(e)}function zi(e){return e instanceof Ze}function Au(e){return e instanceof Je}function Fi(e){return e instanceof We}function Pu(e){return e instanceof He}function it(e){return e instanceof He?e.data:e instanceof Ze||e instanceof Je||e instanceof We?e:Be(e,"Unknown AbstractCrdt")}function dt(e){return e instanceof We||e instanceof Je||e instanceof Ze?e:new He(e)}function Tu(e,t){const n=[];return e.forEach((r,i)=>{t.get(i)||n.push({type:5,id:i})}),t.forEach((r,i)=>{const o=e.get(i);if(o)r.type===0&&(o.type!==0||JSON.stringify(r.data)!==JSON.stringify(o.data))&&n.push({type:3,id:i,data:r.data}),r.parentKey!==o.parentKey&&n.push({type:1,id:i,parentKey:X(r.parentKey,"Parent key must not be missing")});else switch(r.type){case 3:n.push({type:8,id:i,parentId:r.parentId,parentKey:r.parentKey,data:r.data});break;case 1:n.push({type:2,id:i,parentId:r.parentId,parentKey:r.parentKey});break;case 0:n.push(r.parentId?{type:4,id:i,parentId:r.parentId,parentKey:r.parentKey,data:r.data}:{type:4,id:i,data:r.data});break;case 2:n.push({type:7,id:i,parentId:r.parentId,parentKey:r.parentKey});break}}),n}function Nu(e,t){const n=e.updates;for(const[r,i]of Hi(t.updates))n[r]=i;return fn(Mt({},t),{updates:n})}function Mu(e,t){const n=e.updates;for(const[r,i]of Hi(t.updates))n[r]=i;return fn(Mt({},t),{updates:n})}function Lu(e,t){const n=e.updates;return fn(Mt({},t),{updates:n.concat(t.updates)})}function Ru(e,t){return e?e.type==="LiveObject"&&t.type==="LiveObject"?Nu(e,t):e.type==="LiveMap"&&t.type==="LiveMap"?Mu(e,t):e.type==="LiveList"&&t.type==="LiveList"?Lu(e,t):t:t}function Cr(e){const t=typeof e;return e==null||t==="string"||t==="boolean"||t==="number"||Array.isArray(e)||or(e)}function or(e){return e!==null&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"}function Ki(e,t=""){if(!Cr)return{path:t||"root",value:e};if(typeof e!="object"||e===null)return!1;for(const[n,r]of Object.entries(e)){const i=t?t+"."+n:n;if(!Cr(r))return{path:i,value:r};if(typeof r=="object"){const o=Ki(r,i);if(o)return o}}return!1}function Cu(e){const t={};for(const[n,r]of e)t[n]=r;return t}function Hi(e){return Object.entries(e)}function Vi(e){try{return JSON.parse(e)}catch{return}}function Bi(e){try{const t=e.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(t).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch{return atob(e)}}function Uu(e,t){return Ci(e._getParentKeyOrThrow(),t._getParentKeyOrThrow())}var Ze=class extends hn{constructor(e=[]){super(),this._items=[],this._implicitlyDeletedItems=new WeakSet,this._unacknowledgedSets=new Map;let t;for(let n=0;n<e.length;n++){const r=Le(t),i=dt(e[n]);i._setParentLink(this,r),this._items.push(i),t=r}}static _deserialize([e],t,n){const r=new Ze;r._attach(e,n);const i=t.get(e);if(i===void 0)return r;for(const[o,s]of i){const a=Di([o,s],t,n);a._setParentLink(r,s.parentKey),r._insertAndSort(a)}return r}_toOps(e,t,n){if(this._id===void 0)throw new Error("Cannot serialize item is not attached");const r=[],i={id:this._id,opId:n==null?void 0:n.generateOpId(),type:2,parentId:e,parentKey:t};r.push(i);for(const o of this._items)r.push(...o._toOps(this._id,o._getParentKeyOrThrow(),n));return r}_insertAndSort(e){this._items.push(e),this._sortItems()}_sortItems(){this._items.sort(Uu),this.invalidate()}_indexOfPosition(e){return this._items.findIndex(t=>t._getParentKeyOrThrow()===e)}_attach(e,t){super._attach(e,t);for(const n of this._items)n._attach(t.generateId(),t)}_detach(){super._detach();for(const e of this._items)e._detach()}_applySetRemote(e){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const{id:t,parentKey:n}=e,r=xt(e);r._attach(t,this._pool),r._setParentLink(this,n);const i=e.deletedId,o=this._indexOfPosition(n);if(o!==-1){const s=this._items[o];if(s._id===i)return s._detach(),this._items[o]=r,{modified:J(this,[ut(o,r)]),reverse:[]};{this._implicitlyDeletedItems.add(s),this._items[o]=r;const a=[ut(o,r)],l=this._detachItemAssociatedToSetOperation(e.deletedId);return l&&a.push(l),{modified:J(this,a),reverse:[]}}}else{const s=[],a=this._detachItemAssociatedToSetOperation(e.deletedId);return a&&s.push(a),this._insertAndSort(r),s.push(Me(this._indexOfPosition(n),r)),{reverse:[],modified:J(this,s)}}}_applySetAck(e){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const t=[],n=this._detachItemAssociatedToSetOperation(e.deletedId);n&&t.push(n);const r=this._unacknowledgedSets.get(e.parentKey);if(r!==void 0){if(r!==e.opId)return t.length===0?{modified:!1}:{modified:J(this,t),reverse:[]};this._unacknowledgedSets.delete(e.parentKey)}const i=this._indexOfPosition(e.parentKey),o=this._items.find(s=>s._id===e.id);if(o!==void 0){if(o._parentKey===e.parentKey)return{modified:t.length>0?J(this,t):!1,reverse:[]};i!==-1&&(this._implicitlyDeletedItems.add(this._items[i]),this._items.splice(i,1),t.push($t(i)));const s=this._items.indexOf(o);o._setParentLink(this,e.parentKey),this._sortItems();const a=this._items.indexOf(o);return a!==s&&t.push(et(s,a,o)),{modified:t.length>0?J(this,t):!1,reverse:[]}}else{const s=this._pool.getNode(e.id);if(s&&this._implicitlyDeletedItems.has(s)){s._setParentLink(this,e.parentKey),this._implicitlyDeletedItems.delete(s),this._insertAndSort(s);const a=this._items.indexOf(s);return{modified:J(this,[i===-1?Me(a,s):ut(a,s),...t]),reverse:[]}}else{i!==-1&&this._items.splice(i,1);const{newItem:a,newIndex:l}=this._createAttachItemAndSort(e,e.parentKey);return{modified:J(this,[i===-1?Me(l,a):ut(l,a),...t]),reverse:[]}}}}_detachItemAssociatedToSetOperation(e){if(e===void 0||this._pool===void 0)return null;const t=this._pool.getNode(e);if(t===void 0)return null;const n=this._detachChild(t);return n.modified===!1?null:n.modified.updates[0]}_applyRemoteInsert(e){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");const t=e.parentKey,n=this._indexOfPosition(t);n!==-1&&this._shiftItemPosition(n,t);const{newItem:r,newIndex:i}=this._createAttachItemAndSort(e,t);return{modified:J(this,[Me(i,r)]),reverse:[]}}_applyInsertAck(e){const t=this._items.find(i=>i._id===e.id),n=e.parentKey,r=this._indexOfPosition(n);if(t){if(t._parentKey===n)return{modified:!1};{const i=this._items.indexOf(t);r!==-1&&this._shiftItemPosition(r,n),t._setParentLink(this,n),this._sortItems();const o=this._indexOfPosition(n);return o===i?{modified:!1}:{modified:J(this,[et(i,o,t)]),reverse:[]}}}else{const i=X(this._pool).getNode(e.id);if(i&&this._implicitlyDeletedItems.has(i)){i._setParentLink(this,n),this._implicitlyDeletedItems.delete(i),this._insertAndSort(i);const o=this._indexOfPosition(n);return{modified:J(this,[Me(o,i)]),reverse:[]}}else{r!==-1&&this._shiftItemPosition(r,n);const{newItem:o,newIndex:s}=this._createAttachItemAndSort(e,n);return{modified:J(this,[Me(s,o)]),reverse:[]}}}}_applyInsertUndoRedo(e){var t;const{id:n,parentKey:r}=e,i=xt(e);if(((t=this._pool)==null?void 0:t.getNode(n))!==void 0)return{modified:!1};i._attach(n,X(this._pool)),i._setParentLink(this,r);const o=this._indexOfPosition(r);let s=r;if(o!==-1){const l=this._items[o]?this._items[o]._getParentKeyOrThrow():void 0,u=this._items[o+1]?this._items[o+1]._getParentKeyOrThrow():void 0;s=Le(l,u),i._setParentLink(this,s)}this._insertAndSort(i);const a=this._indexOfPosition(s);return{modified:J(this,[Me(a,i)]),reverse:[{type:5,id:n}]}}_applySetUndoRedo(e){var t;const{id:n,parentKey:r}=e,i=xt(e);if(((t=this._pool)==null?void 0:t.getNode(n))!==void 0)return{modified:!1};this._unacknowledgedSets.set(r,X(e.opId));const o=this._indexOfPosition(r);i._attach(n,X(this._pool)),i._setParentLink(this,r);const s=r;if(o!==-1){const a=this._items[o];a._detach(),this._items[o]=i;const l=a._toOps(X(this._id),r,this._pool);bn(l,e.id);const u=[ut(o,i)],c=this._detachItemAssociatedToSetOperation(e.deletedId);return c&&u.push(c),{modified:J(this,u),reverse:l}}else{this._insertAndSort(i),this._detachItemAssociatedToSetOperation(e.deletedId);const a=this._indexOfPosition(s);return{reverse:[{type:5,id:n}],modified:J(this,[Me(a,i)])}}}_attachChild(e,t){if(this._pool===void 0)throw new Error("Can't attach child if managed pool is not present");let n;return e.intent==="set"?t===1?n=this._applySetRemote(e):t===2?n=this._applySetAck(e):n=this._applySetUndoRedo(e):t===1?n=this._applyRemoteInsert(e):t===2?n=this._applyInsertAck(e):n=this._applyInsertUndoRedo(e),n.modified!==!1&&this.invalidate(),n}_detachChild(e){if(e){const t=X(e._parentKey),n=e._toOps(X(this._id),t,this._pool),r=this._items.indexOf(e);return r===-1?{modified:!1}:(this._items.splice(r,1),this.invalidate(),e._detach(),{modified:J(this,[$t(r)]),reverse:n})}return{modified:!1}}_applySetChildKeyRemote(e,t){var n;if(this._implicitlyDeletedItems.has(t)){this._implicitlyDeletedItems.delete(t),t._setParentLink(this,e),this._insertAndSort(t);const o=this._items.indexOf(t);return{modified:J(this,[Me(o,t)]),reverse:[]}}const r=t._parentKey;if(e===r)return{modified:!1};const i=this._indexOfPosition(e);if(i===-1){const o=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();const s=this._items.indexOf(t);return s===o?{modified:!1}:{modified:J(this,[et(o,s,t)]),reverse:[]}}else{this._items[i]._setParentLink(this,Le(e,(n=this._items[i+1])==null?void 0:n._getParentKeyOrThrow()));const o=this._items.indexOf(t);t._setParentLink(this,e),this._sortItems();const s=this._items.indexOf(t);return s===o?{modified:!1}:{modified:J(this,[et(o,s,t)]),reverse:[]}}}_applySetChildKeyAck(e,t){var n,r;const i=X(t._parentKey);if(this._implicitlyDeletedItems.has(t)){const o=this._indexOfPosition(e);return this._implicitlyDeletedItems.delete(t),o!==-1&&this._items[o]._setParentLink(this,Le(e,(n=this._items[o+1])==null?void 0:n._getParentKeyOrThrow())),t._setParentLink(this,e),this._insertAndSort(t),{modified:!1}}else{if(e===i)return{modified:!1};const o=this._items.indexOf(t),s=this._indexOfPosition(e);s!==-1&&this._items[s]._setParentLink(this,Le(e,(r=this._items[s+1])==null?void 0:r._getParentKeyOrThrow())),t._setParentLink(this,e),this._sortItems();const a=this._items.indexOf(t);return o===a?{modified:!1}:{modified:J(this,[et(o,a,t)]),reverse:[]}}}_applySetChildKeyUndoRedo(e,t){var n;const r=X(t._parentKey),i=this._items.indexOf(t),o=this._indexOfPosition(e);o!==-1&&this._items[o]._setParentLink(this,Le(e,(n=this._items[o+1])==null?void 0:n._getParentKeyOrThrow())),t._setParentLink(this,e),this._sortItems();const s=this._items.indexOf(t);return i===s?{modified:!1}:{modified:J(this,[et(i,s,t)]),reverse:[{type:1,id:X(t._id),parentKey:r}]}}_setChildKey(e,t,n){return n===1?this._applySetChildKeyRemote(e,t):n===2?this._applySetChildKeyAck(e,t):this._applySetChildKeyUndoRedo(e,t)}_apply(e,t){return super._apply(e,t)}_serialize(){if(this.parent.type!=="HasParent")throw new Error("Cannot serialize LiveList if parent is missing");return{type:1,parentId:X(this.parent.node._id,"Parent node expected to have ID"),parentKey:this.parent.key}}get length(){return this._items.length}push(e){return this.insert(e,this.length)}insert(e,t){if(t<0||t>this._items.length)throw new Error(`Cannot insert list item at index "${t}". index should be between 0 and ${this._items.length}`);const n=this._items[t-1]?this._items[t-1]._getParentKeyOrThrow():void 0,r=this._items[t]?this._items[t]._getParentKeyOrThrow():void 0,i=Le(n,r),o=dt(e);if(o._setParentLink(this,i),this._insertAndSort(o),this._pool&&this._id){const s=this._pool.generateId();o._attach(s,this._pool),this._pool.dispatch(o._toOps(this._id,i,this._pool),[{type:5,id:s}],new Map([[this._id,J(this,[Me(t,o)])]]))}}move(e,t){if(t<0)throw new Error("targetIndex cannot be less than 0");if(t>=this._items.length)throw new Error("targetIndex cannot be greater or equal than the list length");if(e<0)throw new Error("index cannot be less than 0");if(e>=this._items.length)throw new Error("index cannot be greater or equal than the list length");let n=null,r=null;e<t?(r=t===this._items.length-1?void 0:this._items[t+1]._getParentKeyOrThrow(),n=this._items[t]._getParentKeyOrThrow()):(r=this._items[t]._getParentKeyOrThrow(),n=t===0?void 0:this._items[t-1]._getParentKeyOrThrow());const i=Le(n,r),o=this._items[e],s=o._getParentKeyOrThrow();if(o._setParentLink(this,i),this._sortItems(),this._pool&&this._id){const a=new Map([[this._id,J(this,[et(e,t,o)])]]);this._pool.dispatch([{type:1,id:X(o._id),opId:this._pool.generateOpId(),parentKey:i}],[{type:1,id:X(o._id),parentKey:s}],a)}}delete(e){if(e<0||e>=this._items.length)throw new Error(`Cannot delete list item at index "${e}". index should be between 0 and ${this._items.length-1}`);const t=this._items[e];if(t._detach(),this._items.splice(e,1),this.invalidate(),this._pool){const n=t._id;if(n){const r=new Map;r.set(X(this._id),J(this,[$t(e)])),this._pool.dispatch([{id:n,opId:this._pool.generateOpId(),type:5}],t._toOps(X(this._id),t._getParentKeyOrThrow()),r)}}}clear(){if(this._pool){const e=[],t=[],n=[];for(const i of this._items){i._detach();const o=i._id;o&&(e.push({type:5,id:o,opId:this._pool.generateOpId()}),t.push(...i._toOps(X(this._id),i._getParentKeyOrThrow())),n.push($t(0)))}this._items=[],this.invalidate();const r=new Map;r.set(X(this._id),J(this,n)),this._pool.dispatch(e,t,r)}else{for(const e of this._items)e._detach();this._items=[],this.invalidate()}}set(e,t){if(e<0||e>=this._items.length)throw new Error(`Cannot set list item at index "${e}". index should be between 0 and ${this._items.length-1}`);const n=this._items[e],r=n._getParentKeyOrThrow(),i=n._id;n._detach();const o=dt(t);if(o._setParentLink(this,r),this._items[e]=o,this.invalidate(),this._pool&&this._id){const s=this._pool.generateId();o._attach(s,this._pool);const a=new Map;a.set(this._id,J(this,[ut(e,o)]));const l=o._toOps(this._id,r,this._pool);bn(l,i),this._unacknowledgedSets.set(r,X(l[0].opId));const u=n._toOps(this._id,r,void 0);bn(u,s),this._pool.dispatch(l,u,a)}}toArray(){return this._items.map(e=>it(e))}every(e){return this.toArray().every(e)}filter(e){return this.toArray().filter(e)}find(e){return this.toArray().find(e)}findIndex(e){return this.toArray().findIndex(e)}forEach(e){return this.toArray().forEach(e)}get(e){if(!(e<0||e>=this._items.length))return it(this._items[e])}indexOf(e,t){return this.toArray().indexOf(e,t)}lastIndexOf(e,t){return this.toArray().lastIndexOf(e,t)}map(e){return this._items.map((t,n)=>e(it(t),n))}some(e){return this.toArray().some(e)}[Symbol.iterator](){return new $u(this._items)}_createAttachItemAndSort(e,t){const n=xt(e);n._attach(e.id,X(this._pool)),n._setParentLink(this,t),this._insertAndSort(n);const r=this._indexOfPosition(t);return{newItem:n,newIndex:r}}_shiftItemPosition(e,t){var n;const r=Le(t,this._items.length>e+1?(n=this._items[e+1])==null?void 0:n._getParentKeyOrThrow():void 0);this._items[e]._setParentLink(this,r)}toImmutable(){return super.toImmutable()}_toImmutable(){return this._items.map(t=>t.toImmutable())}},$u=class{constructor(e){this._innerIterator=e[Symbol.iterator]()}[Symbol.iterator](){return this}next(){const e=this._innerIterator.next();return e.done?{done:!0,value:void 0}:{value:it(e.value)}}};function J(e,t){return{node:e,type:"LiveList",updates:t}}function ut(e,t){return{index:e,type:"set",item:t instanceof He?t.data:t}}function $t(e){return{index:e,type:"delete"}}function Me(e,t){return{index:e,type:"insert",item:t instanceof He?t.data:t}}function et(e,t,n){return{index:t,type:"move",previousIndex:e,item:n instanceof He?n.data:n}}function bn(e,t){if(e.length===0)throw new Error("Internal error. Serialized LiveStructure should have at least 1 operation");const n=e[0];n.intent="set",n.deletedId=t}var Du=["websocket:presence","websocket:storage","room:read","room:write","rooms:read","rooms:write"];function zu(e){if(!or(e))return!1;const{iat:t,exp:n}=e;return typeof t=="number"&&typeof n=="number"}function Fu(e){const t=Date.now()/1e3;return t>e.exp-300||t<e.iat+300}function Ku(e){return Du.includes(e)}function Xi(e){return Array.isArray(e)&&e.every(t=>typeof t=="string")}function qi(e){return typeof e.appId=="string"&&e.roomId===void 0&&Xi(e.scopes)}function sr(e){return typeof e.appId=="string"&&typeof e.roomId=="string"&&typeof e.actor=="number"&&(e.id===void 0||typeof e.id=="string")&&Xi(e.scopes)&&(e.maxConnectionsPerRoom===void 0||typeof e.maxConnectionsPerRoom=="number")}function Hu(e){return qi(e)||sr(e)}function Vu(e){const t=e.split(".");if(t.length!==3)throw new Error("Authentication error: invalid JWT token");const n=Vi(Bi(t[1]));if(n&&zu(n))return n;throw new Error("Authentication error: missing JWT metadata")}function Bu(e){const t=Vu(e);if(t&&sr(t))return mu(t,["maxConnections"]);throw new Error("Authentication error: we expected a room token but did not get one. Hint: if you are using a callback, ensure the room is passed when creating the token. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientCallback")}function Xu(e){return Object.defineProperty(e,"count",{value:e.length,enumerable:!1}),Object.defineProperty(e,"toArray",{value:()=>e,enumerable:!1}),ir(e)}function Yi(e){return e===null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"}function Gi(e){return Array.isArray(e)}function qu(e){return!Yi(e)&&!Gi(e)}$.__spreadValues=Mt;$.__spreadProps=fn;$.__async=_u;$.deprecate=gu;$.deprecateIf=vu;$.throwUsageError=yu;$.errorIf=wu;$.assertNever=Be;$.nn=X;$.ClientMsgCode=Ai;$.OpCode=Pi;$.CrdtType=Ti;$.isRootCrdt=bu;$.isChildCrdt=Ni;$.ServerMsgCode=Mi;$.isRoomEventName=ku;$.WebsocketCloseCodes=Li;$.LiveRegister=He;$.makePosition=Le;$.comparePosition=Ci;$.LiveList=Ze;$.LiveMap=Je;$.LiveObject=We;$.freeze=ir;$.compact=Ou;$.compactObject=Iu;$.isSameNodeOrChildOf=$i;$.isLiveNode=fe;$.isLiveList=zi;$.isLiveObject=Fi;$.getTreesDiffOperations=Tu;$.mergeStorageUpdates=Ru;$.isPlainObject=or;$.findNonSerializableValue=Ki;$.tryParseJson=Vi;$.b64decode=Bi;$.isTokenExpired=Fu;$.isScope=Ku;$.isAppOnlyAuthToken=qi;$.isRoomAuthToken=sr;$.isAuthToken=Hu;$.parseRoomAuthToken=Bu;$.asArrayWithLegacyMethods=Xu;$.isJsonScalar=Yi;$.isJsonArray=Gi;$.isJsonObject=qu;Object.defineProperty(Ne,"__esModule",{value:!0});var L=$;function ze(){const e=new Set,t=new Set;function n(s){return t.add(s),()=>t.delete(s)}function r(s){return e.add(s),()=>e.delete(s)}function i(s){e.forEach(a=>a(s)),e.clear(),t.forEach(a=>a(s))}function o(){e.clear(),t.clear()}return{notify:i,subscribe:n,subscribeOnce:r,clear:o,observable:{subscribe:n,subscribeOnce:r}}}function ji(e,t){let n=!1;const r=L.__spreadValues.call(void 0,{},e);return Object.keys(t).forEach(i=>{const o=i,s=t[o];r[o]!==s&&(s===void 0?delete r[o]:r[o]=s,n=!0)}),n?r:e}var dn=class{constructor(){this._ev=ze()}get didInvalidate(){return this._ev.observable}invalidate(){this._cache!==void 0&&(this._cache=void 0,this._ev.notify())}get current(){var e;return(e=this._cache)!=null?e:this._cache=this._toImmutable()}},Yu=class extends dn{constructor(e){super(),this._me=L.freeze.call(void 0,L.compactObject.call(void 0,e))}_toImmutable(){return this._me}patch(e){const t=this._me,n=ji(t,e);t!==n&&(this._me=L.freeze.call(void 0,n),this.invalidate())}};function Gu(e,t){return L.freeze.call(void 0,L.compactObject.call(void 0,L.__spreadProps.call(void 0,L.__spreadValues.call(void 0,{},e),{presence:t})))}var ju=class extends dn{constructor(){super(),this._connections={},this._presences={},this._users={}}_toImmutable(){const e=L.compact.call(void 0,Object.keys(this._presences).map(t=>this.getUser(Number(t))));return L.asArrayWithLegacyMethods.call(void 0,e)}clearOthers(){this._connections={},this._presences={},this._users={},this.invalidate()}_getUser(e){const t=this._connections[e],n=this._presences[e];if(t!==void 0&&n!==void 0)return Gu(t,n)}getUser(e){const t=this._users[e];if(t)return t;const n=this._getUser(e);if(n)return this._users[e]=n,n}_invalidateUser(e){this._users[e]!==void 0&&delete this._users[e],this.invalidate()}setConnection(e,t,n){this._connections[e]=L.freeze.call(void 0,{connectionId:e,id:t,info:n}),this._presences[e]!==void 0&&this._invalidateUser(e)}removeConnection(e){delete this._connections[e],delete this._presences[e],this._invalidateUser(e)}setOther(e,t){this._presences[e]=L.freeze.call(void 0,L.compactObject.call(void 0,t)),this._connections[e]!==void 0&&this._invalidateUser(e)}patchOther(e,t){const n=this._presences[e];if(n===void 0)return;const r=ji(n,t);n!==r&&(this._presences[e]=L.freeze.call(void 0,r),this._invalidateUser(e))}},Ju=class extends dn{constructor(e){super(),this._value=L.freeze.call(void 0,L.compactObject.call(void 0,e))}_toImmutable(){return this._value}set(e){this._value=L.freeze.call(void 0,e),this.invalidate()}},Wu=class extends dn{constructor(e,t){super(),this._refs=e,this._refs.forEach(n=>{n.didInvalidate.subscribe(()=>this.invalidate())}),this._transform=t}_toImmutable(){return this._transform(this._refs[0].current,this._refs[1].current)}},kn=[250,500,1e3,2e3,4e3,8e3,1e4],xn=[2e3,3e4,6e4,3e5],Zu=3e4,Qu=2e3;function ec(e){let t=0;return()=>`${e}:${t++}`}function En(e){return e.state==="open"||e.state==="connecting"}function tc(e,t,n){const r={roomId:t.roomId,getNode:h=>e.nodes.get(h),addNode:(h,m)=>void e.nodes.set(h,m),deleteNode:h=>void e.nodes.delete(h),generateId:()=>`${O()}:${e.clock++}`,generateOpId:()=>`${O()}:${e.opClock++}`,dispatch(h,m,w){const k=e.activeBatch;k?(k.ops.push(...h),w.forEach((N,oe)=>{k.updates.storageUpdates.set(oe,L.mergeStorageUpdates.call(void 0,k.updates.storageUpdates.get(oe),N))}),k.reverseOps.push(...m)):(p(m),e.redoStack=[],ur(h),v({storageUpdates:w}))}},i={customEvent:ze(),me:ze(),others:ze(),error:ze(),connection:ze(),storage:ze(),history:ze(),storageDidLoad:ze()},o=n||{authenticate(h,m){const w=e.token,k=w!==null&&L.parseRoomAuthToken.call(void 0,w);if(k&&!L.isTokenExpired.call(void 0,k)){const N=m(w);I(k,N)}else return h(t.roomId).then(({token:N})=>{if(e.connection.current.state!=="authenticating")return;const oe=L.parseRoomAuthToken.call(void 0,N),ne=m(N);I(oe,ne),e.token=N}).catch(N=>S())},send(h){if(e.socket===null)throw new Error("Can't send message if socket is null");e.socket.send(JSON.stringify(h))},delayFlush(h){return setTimeout(ae,h)},startHeartbeatInterval(){return setInterval(se,Zu)},schedulePongTimeout(){return setTimeout(me,Qu)},scheduleReconnect(h){return setTimeout(M,h)}},s=new Wu([e.connection,e.me],(h,m)=>En(h)?{connectionId:h.id,id:h.userId,info:h.userInfo,presence:m}:null);function a(h){if(h.items.length===0)throw new Error("Internal error: cannot load storage without items");e.root?u(h.items):e.root=c(h.items);for(const m in e.initialStorage)e.root.get(m)===void 0&&e.root.set(m,e.initialStorage[m])}function l(h){const m=new Map;let w=null;for(const[k,N]of h)if(L.isRootCrdt.call(void 0,N))w=[k,N];else{const oe=[k,N],ne=m.get(N.parentId);ne!==void 0?ne.push(oe):m.set(N.parentId,[oe])}if(w===null)throw new Error("Root can't be null");return[w,m]}function u(h){if(!e.root)return;const m=new Map;e.nodes.forEach((N,oe)=>{m.set(oe,N._serialize())});const w=L.getTreesDiffOperations.call(void 0,m,new Map(h)),k=U(w,!1);v(k.updates)}function c(h){const[m,w]=l(h);return L.LiveObject._deserialize(m,w,r)}function f(h){e.undoStack.length>=50&&e.undoStack.shift(),e.undoStack.push(h),d()}function p(h){e.pausedHistory!==null?e.pausedHistory.unshift(...h):f(h)}function v({storageUpdates:h=new Map,presence:m=!1,others:w=[]}){if(w.length>0){const k=e.others.current;for(const N of w)i.others.notify({others:k,event:N})}if(m&&i.me.notify(e.me.current),h.size>0){const k=Array.from(h.values());i.storage.notify(k)}}function O(){const h=e.connection.current;if(En(h))return h.id;if(e.lastConnectionId!==null)return e.lastConnectionId;throw new Error("Internal. Tried to get connection id but connection was never open")}function U(h,m){const w={reverse:[],updates:{storageUpdates:new Map,presence:!1}},k=new Set;for(const N of h)if(N.type==="presence"){const oe={type:"presence",data:{}};for(const ne in N.data)oe.data[ne]=e.me.current[ne];if(e.me.patch(N.data),e.buffer.me===null)e.buffer.me={type:"partial",data:N.data};else for(const ne in N.data)e.buffer.me.data[ne]=N.data[ne];w.reverse.unshift(oe),w.updates.presence=!0}else{let oe;N.opId||(N.opId=r.generateOpId()),m?oe=0:oe=e.offlineOperations.delete(L.nn.call(void 0,N.opId))?2:1;const ne=H(N,oe);if(ne.modified){const gn=ne.modified.node.parent.type==="HasParent"?L.nn.call(void 0,ne.modified.node.parent.node._id,"Expected parent node to have an ID"):void 0;(!gn||!k.has(gn))&&(w.updates.storageUpdates.set(L.nn.call(void 0,ne.modified.node._id),L.mergeStorageUpdates.call(void 0,w.updates.storageUpdates.get(L.nn.call(void 0,ne.modified.node._id)),ne.modified)),w.reverse.unshift(...ne.reverse)),(N.type===2||N.type===7||N.type===4)&&k.add(L.nn.call(void 0,ne.modified.node._id))}}return w}function H(h,m){switch(h.type){case 6:case 3:case 5:{const w=e.nodes.get(h.id);return w===void 0?{modified:!1}:w._apply(h,m===0)}case 1:{const w=e.nodes.get(h.id);return w===void 0?{modified:!1}:w.parent.type==="HasParent"&&L.isLiveList.call(void 0,w.parent.node)?w.parent.node._setChildKey(h.parentKey,w,m):{modified:!1}}case 4:case 2:case 7:case 8:{if(h.parentId===void 0)return{modified:!1};const w=e.nodes.get(h.parentId);return w===void 0?{modified:!1}:w._attachChild(h,m)}}}function b(h,m){return i.storage.subscribe(w=>{const k=w.filter(N=>L.isSameNodeOrChildOf.call(void 0,N.node,h));k.length>0&&m(k)})}function B(h,m){return i.storage.subscribe(w=>{for(const k of w)k.node._id===h._id&&m(k.node)})}function y(h,m,w){if(typeof h=="string"&&L.isRoomEventName.call(void 0,h)){if(typeof m!="function")throw new Error("Second argument must be a callback function");const k=m;switch(h){case"event":return i.customEvent.subscribe(k);case"my-presence":return i.me.subscribe(k);case"others":{const N=k;return i.others.subscribe(({others:oe,event:ne})=>N(oe,ne))}case"error":return i.error.subscribe(k);case"connection":return i.connection.subscribe(k);case"storage":return i.storage.subscribe(k);case"history":return i.history.subscribe(k);default:return L.assertNever.call(void 0,h,"Unknown event")}}if(m===void 0||typeof h=="function")if(typeof h=="function"){const k=h;return i.storage.subscribe(k)}else throw new Error("Please specify a listener callback");if(L.isLiveNode.call(void 0,h)){const k=h;return w!=null&&w.isDeep?b(k,m):B(k,m)}throw new Error(`"${h}" is not a valid event name`)}function E(){return e.connection.current.state}function M(){var h,m,w,k;if(e.connection.current.state!=="closed"&&e.connection.current.state!=="unavailable")return null;const N=sc(t.authentication,(m=(h=t.polyfills)==null?void 0:h.fetch)!=null?m:t.fetchPolyfill),oe=oc(t.liveblocksServer,(k=(w=t.polyfills)==null?void 0:w.WebSocket)!=null?k:t.WebSocketPolyfill);z({state:"authenticating"}),o.authenticate(N,oe)}function T(h,m){const w={};e.buffer.me===null&&(e.buffer.me={type:"partial",data:{}});for(const k in h){const N=h[k];N!==void 0&&(e.buffer.me.data[k]=N,w[k]=e.me.current[k])}e.me.patch(h),e.activeBatch?(m!=null&&m.addToHistory&&e.activeBatch.reverseOps.push({type:"presence",data:w}),e.activeBatch.updates.presence=!0):(ae(),m!=null&&m.addToHistory&&p([{type:"presence",data:w}]),v({presence:!0}))}function I(h,m){m.addEventListener("message",C),m.addEventListener("open",de),m.addEventListener("close",R),m.addEventListener("error",Z),z({state:"connecting",id:h.actor,userInfo:h.info,userId:h.id}),e.idFactory=ec(h.actor),e.socket=m}function S(h){e.token=null,z({state:"unavailable"}),e.numberOfRetry++,e.timeoutHandles.reconnect=o.scheduleReconnect(G())}function V(h){h==="visible"&&e.connection.current.state==="open"&&se()}function ie(h){if(h.targetActor!==void 0){const w=e.others.getUser(h.actor);e.others.setOther(h.actor,h.data);const k=e.others.getUser(h.actor);if(w===void 0&&k!==void 0)return{type:"enter",user:k}}else e.others.patchOther(h.actor,h.data);const m=e.others.getUser(h.actor);if(m)return{type:"update",updates:h.data,user:m}}function g(h){const m=e.others.getUser(h.actor);return m?(e.others.removeConnection(h.actor),{type:"leave",user:m}):null}function F(h){for(const m in h.users){const w=h.users[m],k=Number(m);e.others.setConnection(k,w.id,w.info)}return{type:"reset"}}function Y(){e.connection.current.state==="unavailable"&&ye()}function d(){i.history.notify({canUndo:fr(),canRedo:hr()})}function x(h){e.others.setConnection(h.actor,h.id,h.info),e.buffer.messages.push({type:100,data:e.me.current,targetActor:h.actor}),ae();const m=e.others.getUser(h.actor);return m?{type:"enter",user:m}:void 0}function _(h){return L.isJsonObject.call(void 0,h)?h:null}function A(h){const m=L.tryParseJson.call(void 0,h);return m===void 0?null:L.isJsonArray.call(void 0,m)?L.compact.call(void 0,m.map(w=>_(w))):L.compact.call(void 0,[_(m)])}function C(h){if(h.data==="pong"){clearTimeout(e.timeoutHandles.pongTimeout);return}const m=A(h.data);if(m===null||m.length===0)return;const w={storageUpdates:new Map,others:[]};for(const k of m)switch(k.type){case 101:{const N=x(k);N&&w.others.push(N);break}case 100:{const N=ie(k);N&&w.others.push(N);break}case 103:{i.customEvent.notify({connectionId:k.actor,event:k.event});break}case 102:{const N=g(k);N&&w.others.push(N);break}case 104:{w.others.push(F(k));break}case 200:{const N=new Map(e.offlineOperations);a(k),_e(N),_n==null||_n(),i.storageDidLoad.notify();break}case 201:{U(k.ops,!1).updates.storageUpdates.forEach((oe,ne)=>{w.storageUpdates.set(ne,L.mergeStorageUpdates.call(void 0,w.storageUpdates.get(ne),oe))});break}}v(w)}function R(h){if(e.socket=null,clearTimeout(e.timeoutHandles.pongTimeout),clearInterval(e.intervalHandles.heartbeat),e.timeoutHandles.flush&&clearTimeout(e.timeoutHandles.flush),clearTimeout(e.timeoutHandles.reconnect),e.others.clearOthers(),v({others:[{type:"reset"}]}),h.code>=4e3&&h.code<=4100){z({state:"failed"});const m=new ic(h.reason,h.code);i.error.notify(m);const w=G(!0);e.numberOfRetry++,z({state:"unavailable"}),e.timeoutHandles.reconnect=o.scheduleReconnect(w)}else if(h.code===4999)z({state:"closed"});else{const m=G();e.numberOfRetry++,z({state:"unavailable"}),e.timeoutHandles.reconnect=o.scheduleReconnect(m)}}function z(h){e.connection.set(h),i.connection.notify(h.state)}function G(h=!1){return h?xn[e.numberOfRetry<xn.length?e.numberOfRetry:xn.length-1]:kn[e.numberOfRetry<kn.length?e.numberOfRetry:kn.length-1]}function Z(){}function de(){clearInterval(e.intervalHandles.heartbeat),e.intervalHandles.heartbeat=o.startHeartbeatInterval(),e.connection.current.state==="connecting"&&(z(L.__spreadProps.call(void 0,L.__spreadValues.call(void 0,{},e.connection.current),{state:"open"})),e.numberOfRetry=0,e.lastConnectionId!==void 0&&(e.buffer.me={type:"full",data:L.__spreadValues.call(void 0,{},e.me.current)},ae()),e.lastConnectionId=e.connection.current.id,e.root&&e.buffer.messages.push({type:200}),ae())}function se(){e.socket!==null&&(clearTimeout(e.timeoutHandles.pongTimeout),e.timeoutHandles.pongTimeout=o.schedulePongTimeout(),e.socket.readyState===e.socket.OPEN&&e.socket.send("ping"))}function me(){ye()}function ye(){e.socket&&(e.socket.removeEventListener("open",de),e.socket.removeEventListener("message",C),e.socket.removeEventListener("close",R),e.socket.removeEventListener("error",Z),e.socket.close(),e.socket=null),z({state:"unavailable"}),clearTimeout(e.timeoutHandles.pongTimeout),e.timeoutHandles.flush&&clearTimeout(e.timeoutHandles.flush),clearTimeout(e.timeoutHandles.reconnect),clearInterval(e.intervalHandles.heartbeat),M()}function _e(h){if(h.size===0)return;const m=[],w=Array.from(h.values()),k=U(w,!0);m.push({type:201,ops:w}),v(k.updates),o.send(m)}function ae(){const h=e.buffer.storageOperations;if(h.length>0&&h.forEach(k=>{e.offlineOperations.set(L.nn.call(void 0,k.opId),k)}),e.socket===null||e.socket.readyState!==e.socket.OPEN){e.buffer.storageOperations=[];return}const m=Date.now();if(m-e.lastFlushTime>t.throttleDelay){const k=vt(e);if(k.length===0)return;o.send(k),e.buffer={messages:[],storageOperations:[],me:null},e.lastFlushTime=m}else e.timeoutHandles.flush!==null&&clearTimeout(e.timeoutHandles.flush),e.timeoutHandles.flush=o.delayFlush(t.throttleDelay-(m-e.lastFlushTime))}function vt(h){const m=[];h.buffer.me&&m.push(h.buffer.me.type==="full"?{type:100,targetActor:-1,data:h.buffer.me.data}:{type:100,data:h.buffer.me.data});for(const w of h.buffer.messages)m.push(w);return h.buffer.storageOperations.length>0&&m.push({type:201,ops:h.buffer.storageOperations}),m}function oo(){e.socket&&(e.socket.removeEventListener("open",de),e.socket.removeEventListener("message",C),e.socket.removeEventListener("close",R),e.socket.removeEventListener("error",Z),e.socket.close(),e.socket=null),z({state:"closed"}),e.timeoutHandles.flush&&clearTimeout(e.timeoutHandles.flush),clearTimeout(e.timeoutHandles.reconnect),clearTimeout(e.timeoutHandles.pongTimeout),clearInterval(e.intervalHandles.heartbeat),e.others.clearOthers(),v({others:[{type:"reset"}]}),Object.values(i).forEach(h=>h.clear())}function so(){return e.me.current}function ao(){return e.others.current}function lo(h,m={shouldQueueEventIfNotReady:!1}){e.socket===null&&!m.shouldQueueEventIfNotReady||(e.buffer.messages.push({type:103,event:h}),ae())}function ur(h){e.buffer.storageOperations.push(...h),ae()}let mn=null,_n=null;function cr(){return mn===null&&(e.buffer.messages.push({type:200}),ae(),mn=new Promise(h=>_n=h)),mn}function uo(){const h=e.root;return h!==void 0?h:(cr(),null)}function co(){return L.__async.call(void 0,this,null,function*(){return e.root?Promise.resolve({root:e.root}):(yield cr(),{root:L.nn.call(void 0,e.root)})})}function fo(){if(e.activeBatch)throw new Error("undo is not allowed during a batch");const h=e.undoStack.pop();if(h===void 0)return;e.pausedHistory=null;const m=U(h,!0);v(m.updates),e.redoStack.push(m.reverse),d();for(const w of h)w.type!=="presence"&&e.buffer.storageOperations.push(w);ae()}function fr(){return e.undoStack.length>0}function ho(){if(e.activeBatch)throw new Error("redo is not allowed during a batch");const h=e.redoStack.pop();if(h===void 0)return;e.pausedHistory=null;const m=U(h,!0);v(m.updates),e.undoStack.push(m.reverse),d();for(const w of h)w.type!=="presence"&&e.buffer.storageOperations.push(w);ae()}function hr(){return e.redoStack.length>0}function po(h){if(e.activeBatch)return h();e.activeBatch={ops:[],updates:{storageUpdates:new Map,presence:!1,others:[]},reverseOps:[]};try{return h()}finally{const m=e.activeBatch;e.activeBatch=null,m.reverseOps.length>0&&p(m.reverseOps),m.ops.length>0&&(e.redoStack=[]),m.ops.length>0&&ur(m.ops),v(m.updates),ae()}}function mo(){e.pausedHistory=[]}function _o(){const h=e.pausedHistory;e.pausedHistory=null,h!==null&&h.length>0&&f(h)}function go(){e.socket&&(e.socket=null)}function vo(h){R(h)}return{onClose:R,onMessage:C,authenticationSuccess:I,heartbeat:se,onNavigatorOnline:Y,simulateSocketClose:go,simulateSendCloseEvent:vo,onVisibilityChange:V,getUndoStack:()=>e.undoStack,getItemsCount:()=>e.nodes.size,connect:M,disconnect:oo,subscribe:y,updatePresence:T,broadcastEvent:lo,batch:po,undo:fo,redo:ho,canUndo:fr,canRedo:hr,pauseHistory:mo,resumeHistory:_o,getStorage:co,getStorageSnapshot:uo,events:{customEvent:i.customEvent.observable,others:i.others.observable,me:i.me.observable,error:i.error.observable,connection:i.connection.observable,storage:i.storage.observable,history:i.history.observable,storageDidLoad:i.storageDidLoad.observable},getConnectionState:E,isSelfAware:()=>En(e.connection.current),getSelf:()=>s.current,getPresence:so,getOthers:ao}}function nc(e,t){const n=new ju,r=new Ju({state:"closed"});return{token:null,lastConnectionId:null,socket:null,numberOfRetry:0,lastFlushTime:0,timeoutHandles:{flush:null,reconnect:0,pongTimeout:0},buffer:{me:{type:"full",data:e},messages:[],storageOperations:[]},intervalHandles:{heartbeat:0},connection:r,me:new Yu(e),others:n,initialStorage:t,idFactory:null,clock:0,opClock:0,nodes:new Map,root:void 0,undoStack:[],redoStack:[],pausedHistory:null,activeBatch:null,offlineOperations:new Map}}function rc(e,t){const{initialPresence:n,initialStorage:r}=e,i=nc(typeof n=="function"?n(t.roomId):n,typeof r=="function"?r(t.roomId):r),o=tc(i,t),s={id:t.roomId,getConnectionState:o.getConnectionState,isSelfAware:o.isSelfAware,getSelf:o.getSelf,subscribe:o.subscribe,getPresence:o.getPresence,updatePresence:o.updatePresence,getOthers:o.getOthers,broadcastEvent:o.broadcastEvent,getStorage:o.getStorage,getStorageSnapshot:o.getStorageSnapshot,events:o.events,batch:o.batch,history:{undo:o.undo,redo:o.redo,canUndo:o.canUndo,canRedo:o.canRedo,pause:o.pauseHistory,resume:o.resumeHistory},__INTERNAL_DO_NOT_USE:{simulateCloseWebsocket:o.simulateSocketClose,simulateSendCloseEvent:o.simulateSendCloseEvent}};return{connect:o.connect,disconnect:o.disconnect,onNavigatorOnline:o.onNavigatorOnline,onVisibilityChange:o.onVisibilityChange,room:s}}var ic=class extends Error{constructor(e,t){super(e),this.code=t}};function oc(e,t){if(typeof window>"u"&&t===void 0)throw new Error("To use Liveblocks client in a non-dom environment, you need to provide a WebSocket polyfill.");const n=t||WebSocket;return r=>new n(`${e}/?token=${r}&version=0.18.2`)}function sc(e,t){if(e.type==="public"){if(typeof window>"u"&&t===void 0)throw new Error("To use Liveblocks client in a non-dom environment with a publicApiKey, you need to provide a fetch polyfill.");return n=>Ur(t||fetch,e.url,{room:n,publicApiKey:e.publicApiKey})}if(e.type==="private"){if(typeof window>"u"&&t===void 0)throw new Error("To use Liveblocks client in a non-dom environment with a url as auth endpoint, you need to provide a fetch polyfill.");return n=>Ur(t||fetch,e.url,{room:n})}if(e.type==="custom")return n=>L.__async.call(void 0,this,null,function*(){const r=yield e.callback(n);if(!r||!r.token)throw new Error('Authentication error. We expect the authentication callback to return a token, but it does not. Hint: the return value should look like: { token: "..." }');return r});throw new Error("Internal error. Unexpected authentication type")}function Ur(e,t,n){return L.__async.call(void 0,this,null,function*(){const r=yield e(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok)throw new On(`Expected a status 200 but got ${r.status} when doing a POST request on "${t}"`);let i;try{i=yield r.json()}catch(s){throw new On(`Expected a JSON response when doing a POST request on "${t}". ${s}`)}if(!L.isPlainObject.call(void 0,i)||typeof i.token!="string")throw new On(`Expected a JSON response of the form \`{ token: "..." }\` when doing a POST request on "${t}", but got ${JSON.stringify(i)}`);const{token:o}=i;return{token:o}})}var On=class extends Error{constructor(e){super(e)}};function ac(e){const t=e,n=lc(e),r=new Map;function i(a){const l=r.get(a);return l?l.room:null}function o(a,l){var u,c;let f=r.get(a);if(f)return f.room;if(L.deprecateIf.call(void 0,l.initialPresence===null||l.initialPresence===void 0,"Please provide an initial presence value for the current user when entering the room."),f=rc({initialPresence:(u=l.initialPresence)!=null?u:{},initialStorage:l.initialStorage},{roomId:a,throttleDelay:n,polyfills:t.polyfills,WebSocketPolyfill:t.WebSocketPolyfill,fetchPolyfill:t.fetchPolyfill,liveblocksServer:(t==null?void 0:t.liveblocksServer)||"wss://api.liveblocks.io/v6",authentication:uc(t,a)}),r.set(a,f),!l.DO_NOT_USE_withoutConnecting){if(typeof atob>"u"){if(((c=t.polyfills)==null?void 0:c.atob)===void 0)throw new Error("You need to polyfill atob to use the client in your environment. Please follow the instructions at https://liveblocks.io/docs/errors/liveblocks-client/atob-polyfill");fu.atob=t.polyfills.atob}f.connect()}return f.room}function s(a){const l=r.get(a);l&&(l.disconnect(),r.delete(a))}return typeof window<"u"&&typeof window.addEventListener<"u"&&window.addEventListener("online",()=>{for(const[,a]of r)a.onNavigatorOnline()}),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{for(const[,a]of r)a.onVisibilityChange(document.visibilityState)}),{getRoom:i,enter:o,leave:s}}function lc(e){if(e.throttle===void 0)return 100;if(typeof e.throttle!="number"||e.throttle<80||e.throttle>1e3)throw new Error("throttle should be a number between 80 and 1000.");return e.throttle}function uc(e,t){const{publicApiKey:n,authEndpoint:r}=e;if(r!==void 0&&n!==void 0)throw new Error("You cannot use both publicApiKey and authEndpoint. Please use either publicApiKey or authEndpoint, but not both. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient");if(typeof n=="string"){if(n.startsWith("sk_"))throw new Error("Invalid publicApiKey. You are using the secret key which is not supported. Please use the public key instead. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");if(!n.startsWith("pk_"))throw new Error("Invalid key. Please use the public key format: pk_<public key>. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientPublicKey");return{type:"public",publicApiKey:n,url:cc(e,t)}}if(typeof r=="string")return{type:"private",url:r};if(typeof r=="function")return{type:"custom",callback:r};throw r!==void 0?new Error("authEndpoint must be a string or a function. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClientAuthEndpoint"):new Error("Invalid Liveblocks client options. For more information: https://liveblocks.io/docs/api-reference/liveblocks-client#createClient")}function cc(e,t){return e.publicAuthorizeEndpoint?e.publicAuthorizeEndpoint.replace("{roomId}",t):`https://api.liveblocks.io/v2/rooms/${encodeURIComponent(t)}/public/authorize`}function fc(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function hc(e,t){if(typeof e!="object"||e===null||typeof t!="object"||t===null||Object.prototype.toString.call(e)!=="[object Object]"||Object.prototype.toString.call(t)!=="[object Object]")return!1;const n=Object.keys(e);return n.length!==Object.keys(t).length?!1:n.every(r=>Object.prototype.hasOwnProperty.call(t,r)&&Object.is(e[r],t[r]))}function dc(e,t){if(Object.is(e,t))return!0;const n=Array.isArray(e),r=Array.isArray(t);return n||r?!n||!r?!1:fc(e,t):hc(e,t)}Ne.LiveList=L.LiveList;Ne.LiveMap=L.LiveMap;Ne.LiveObject=L.LiveObject;Ne.createClient=ac;Ne.shallow=dc;const pc=Ne.LiveList;Ne.LiveMap;Ne.LiveObject;const mc=Ne.createClient;Ne.shallow;function _c(e){let t,n,r,i,o,s,a,l;return{c(){t=ee("div"),n=qt("svg"),r=qt("path"),i=ue(),o=ee("div"),s=xe(e[2]),this.h()},l(u){t=te(u,"DIV",{class:!0,style:!0});var c=W(t);n=Yt(c,"svg",{class:!0,width:!0,viewBox:!0,fill:!0,xmlns:!0});var f=W(n);r=Yt(f,"path",{d:!0,fill:!0}),W(r).forEach(D),f.forEach(D),i=ce(c),o=te(c,"DIV",{class:!0,style:!0});var p=W(o);s=Ee(p,e[2]),p.forEach(D),c.forEach(D),this.h()},h(){P(r,"d","M0.91603 0.916054L7.09131 14.9234L8.89871 8.89873L14.9234 7.09133L0.91603 0.916054Z"),P(r,"fill","#FFB800"),P(n,"class","block z-0 col-span-2 row-span-2"),P(n,"width","40"),P(n,"viewBox","0 0 15 15"),P(n,"fill","currentColor"),P(n,"xmlns","http://www.w3.org/2000/svg"),P(o,"class","absolute right-0 text-4xl col-start-2 row-start-2"),P(o,"style",a=`text-shadow: 0px 5px 5px ${e[1]}`),P(t,"class","cursor svelte-14ka0w3"),P(t,"style",l=`transform: translateX(${e[3].x}px) translateY(${e[3].y}px) scale(${e[0].k});`)},m(u,c){le(u,t,c),K(t,n),K(n,r),K(t,i),K(t,o),K(o,s)},p(u,[c]){c&4&&Sn(s,u[2]),c&2&&a!==(a=`text-shadow: 0px 5px 5px ${u[1]}`)&&P(o,"style",a),c&9&&l!==(l=`transform: translateX(${u[3].x}px) translateY(${u[3].y}px) scale(${u[0].k});`)&&P(t,"style",l)},i:ge,o:ge,d(u){u&&D(t)}}}function gc(e,t,n){let r,{transform:i}=t,{color:o=""}=t,{emoji:s=""}=t,{position:a={x:0,y:0}}=t;return e.$$set=l=>{"transform"in l&&n(0,i=l.transform),"color"in l&&n(1,o=l.color),"emoji"in l&&n(2,s=l.emoji),"position"in l&&n(4,a=l.position)},e.$$.update=()=>{e.$$.dirty&17&&n(3,r={x:i.applyX(a.x),y:i.applyY(a.y)})},[i,o,s,r,a]}class Ji extends Ye{constructor(t){super(),Ge(this,t,gc,_c,je,{transform:0,color:1,emoji:2,position:4})}}function vc(e){let t,n;return{c(){t=qt("svg"),n=qt("path"),this.h()},l(r){t=Yt(r,"svg",{xmlns:!0,fill:!0,width:!0,viewBox:!0,class:!0});var i=W(t);n=Yt(i,"path",{fill:!0,d:!0}),W(n).forEach(D),i.forEach(D),this.h()},h(){P(n,"fill","currentColor"),P(n,"d","M20 12a8 8 0 0 1-8 8v4a12 12 0 0 0 12-12h-4Zm-2-5.3a8 8 0 0 1 2 5.3h4c0-3-1.1-5.8-3-8l-3 2.7Z"),P(t,"xmlns","http://www.w3.org/2000/svg"),P(t,"fill","none"),P(t,"width","50"),P(t,"viewBox","0 0 24 24"),P(t,"class","animate-spin max-w-[1rem] inline-block")},m(r,i){le(r,t,i),K(t,n)},p:ge,i:ge,o:ge,d(r){r&&D(t)}}}class yc extends Ye{constructor(t){super(),Ge(this,t,null,vc,je,{})}}function wc(e){let t,n,r,i,o,s,a,l,u,c;return n=new yc({}),{c(){t=ee("div"),Ie(n.$$.fragment),r=ue(),i=ee("h2"),o=xe("Click to paint"),s=ue(),a=ee("div"),l=xe("A cat on grass"),this.h()},l(f){t=te(f,"DIV",{class:!0,style:!0});var p=W(t);Se(n.$$.fragment,p),r=ce(p),i=te(p,"H2",{class:!0});var v=W(i);o=Ee(v,"Click to paint"),v.forEach(D),s=ce(p),a=te(p,"DIV",{class:!0});var O=W(a);l=Ee(O,"A cat on grass"),O.forEach(D),p.forEach(D),this.h()},h(){P(i,"class","text-lg"),P(a,"class","absolute bottom-0 font-bold"),P(t,"class","frame z-0 flex relative svelte-er2v6n"),P(t,"style",u=`transform: translateX(${e[2].x}px) translateY(${e[2].y}px) scale(${e[0].k});
			background-image: linear-gradient(${e[1]}, rgba(255,255,255,0));
			color: ${e[1]};
	`)},m(f,p){le(f,t,p),Ae(n,t,null),K(t,r),K(t,i),K(i,o),K(t,s),K(t,a),K(a,l),c=!0},p(f,[p]){(!c||p&7&&u!==(u=`transform: translateX(${f[2].x}px) translateY(${f[2].y}px) scale(${f[0].k});
			background-image: linear-gradient(${f[1]}, rgba(255,255,255,0));
			color: ${f[1]};
	`))&&P(t,"style",u)},i(f){c||(q(n.$$.fragment,f),c=!0)},o(f){j(n.$$.fragment,f),c=!1},d(f){f&&D(t),Pe(n)}}}function bc(e,t,n){let r,{transform:i}=t,{color:o=""}=t,{position:s={x:0,y:0}}=t;return e.$$set=a=>{"transform"in a&&n(0,i=a.transform),"color"in a&&n(1,o=a.color),"position"in a&&n(3,s=a.position)},e.$$.update=()=>{e.$$.dirty&9&&n(2,r={x:i.applyX(s.x),y:i.applyY(s.y)})},[i,o,r,s]}class pn extends Ye{constructor(t){super(),Ge(this,t,bc,wc,je,{transform:0,color:1,position:3})}}function Xt(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function kc(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Wi(e){let t,n,r;e.length!==2?(t=Xt,n=(a,l)=>Xt(e(a),l),r=(a,l)=>e(a)-l):(t=e===Xt||e===kc?e:xc,n=e,r=e);function i(a,l,u=0,c=a.length){if(u<c){if(t(l,l)!==0)return c;do{const f=u+c>>>1;n(a[f],l)<0?u=f+1:c=f}while(u<c)}return u}function o(a,l,u=0,c=a.length){if(u<c){if(t(l,l)!==0)return c;do{const f=u+c>>>1;n(a[f],l)<=0?u=f+1:c=f}while(u<c)}return u}function s(a,l,u=0,c=a.length){const f=i(a,l,u,c-1);return f>u&&r(a[f-1],l)>-r(a[f],l)?f-1:f}return{left:i,center:s,right:o}}function xc(){return 0}function Ec(e){return e===null?NaN:+e}const Oc=Wi(Xt),Ic=Oc.right;Wi(Ec).center;const Sc=Ic;var Hn=Math.sqrt(50),Vn=Math.sqrt(10),Bn=Math.sqrt(2);function Ac(e,t,n){var r,i=-1,o,s,a;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((r=t<e)&&(o=e,e=t,t=o),(a=Zi(e,t,n))===0||!isFinite(a))return[];if(a>0){let l=Math.round(e/a),u=Math.round(t/a);for(l*a<e&&++l,u*a>t&&--u,s=new Array(o=u-l+1);++i<o;)s[i]=(l+i)*a}else{a=-a;let l=Math.round(e*a),u=Math.round(t*a);for(l/a<e&&++l,u/a>t&&--u,s=new Array(o=u-l+1);++i<o;)s[i]=(l+i)/a}return r&&s.reverse(),s}function Zi(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=Hn?10:o>=Vn?5:o>=Bn?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=Hn?10:o>=Vn?5:o>=Bn?2:1)}function Pc(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=Hn?i*=10:o>=Vn?i*=5:o>=Bn&&(i*=2),t<e?-i:i}function Tc(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Nc(e){return function(){return e}}function Mc(e){return+e}var $r=[0,1];function ft(e){return e}function Xn(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Nc(isNaN(t)?NaN:.5)}function Lc(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function Rc(e,t,n){var r=e[0],i=e[1],o=t[0],s=t[1];return i<r?(r=Xn(i,r),o=n(s,o)):(r=Xn(r,i),o=n(o,s)),function(a){return o(r(a))}}function Cc(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=Xn(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(a){var l=Sc(e,a,1,r)-1;return o[l](i[l](a))}}function Uc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function $c(){var e=$r,t=$r,n=Zn,r,i,o,s=ft,a,l,u;function c(){var p=Math.min(e.length,t.length);return s!==ft&&(s=Lc(e[0],e[p-1])),a=p>2?Cc:Rc,l=u=null,f}function f(p){return p==null||isNaN(p=+p)?o:(l||(l=a(e.map(r),t,n)))(r(s(p)))}return f.invert=function(p){return s(i((u||(u=a(t,e.map(r),ke)))(p)))},f.domain=function(p){return arguments.length?(e=Array.from(p,Mc),c()):e.slice()},f.range=function(p){return arguments.length?(t=Array.from(p),c()):t.slice()},f.rangeRound=function(p){return t=Array.from(p),n=Ra,c()},f.clamp=function(p){return arguments.length?(s=p?!0:ft,c()):s!==ft},f.interpolate=function(p){return arguments.length?(n=p,c()):n},f.unknown=function(p){return arguments.length?(o=p,f):o},function(p,v){return r=p,i=v,c()}}function Dc(){return $c()(ft,ft)}function zc(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function on(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function gt(e){return e=on(Math.abs(e)),e?e[1]:NaN}function Fc(e,t){return function(n,r){for(var i=n.length,o=[],s=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}function Kc(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Hc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function sn(e){if(!(t=Hc.exec(e)))throw new Error("invalid format: "+e);var t;return new ar({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}sn.prototype=ar.prototype;function ar(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ar.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Vc(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Qi;function Bc(e,t){var n=on(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(Qi=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+on(e,Math.max(0,t+o-1))[0]}function Dr(e,t){var n=on(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const zr={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:zc,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Dr(e*100,t),r:Dr,s:Bc,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Fr(e){return e}var Kr=Array.prototype.map,Hr=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Xc(e){var t=e.grouping===void 0||e.thousands===void 0?Fr:Fc(Kr.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?Fr:Kc(Kr.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=sn(f);var p=f.fill,v=f.align,O=f.sign,U=f.symbol,H=f.zero,b=f.width,B=f.comma,y=f.precision,E=f.trim,M=f.type;M==="n"?(B=!0,M="g"):zr[M]||(y===void 0&&(y=12),E=!0,M="g"),(H||p==="0"&&v==="=")&&(H=!0,p="0",v="=");var T=U==="$"?n:U==="#"&&/[boxX]/.test(M)?"0"+M.toLowerCase():"",I=U==="$"?r:/[%p]/.test(M)?s:"",S=zr[M],V=/[defgprs%]/.test(M);y=y===void 0?6:/[gprs]/.test(M)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function ie(g){var F=T,Y=I,d,x,_;if(M==="c")Y=S(g)+Y,g="";else{g=+g;var A=g<0||1/g<0;if(g=isNaN(g)?l:S(Math.abs(g),y),E&&(g=Vc(g)),A&&+g==0&&O!=="+"&&(A=!1),F=(A?O==="("?O:a:O==="-"||O==="("?"":O)+F,Y=(M==="s"?Hr[8+Qi/3]:"")+Y+(A&&O==="("?")":""),V){for(d=-1,x=g.length;++d<x;)if(_=g.charCodeAt(d),48>_||_>57){Y=(_===46?i+g.slice(d+1):g.slice(d))+Y,g=g.slice(0,d);break}}}B&&!H&&(g=t(g,1/0));var C=F.length+g.length+Y.length,R=C<b?new Array(b-C+1).join(p):"";switch(B&&H&&(g=t(R+g,R.length?b-Y.length:1/0),R=""),v){case"<":g=F+g+Y+R;break;case"=":g=F+R+g+Y;break;case"^":g=R.slice(0,C=R.length>>1)+F+g+Y+R.slice(C);break;default:g=R+F+g+Y;break}return o(g)}return ie.toString=function(){return f+""},ie}function c(f,p){var v=u((f=sn(f),f.type="f",f)),O=Math.max(-8,Math.min(8,Math.floor(gt(p)/3)))*3,U=Math.pow(10,-O),H=Hr[8+O/3];return function(b){return v(U*b)+H}}return{format:u,formatPrefix:c}}var Dt,eo,to;qc({thousands:",",grouping:[3],currency:["$",""]});function qc(e){return Dt=Xc(e),eo=Dt.format,to=Dt.formatPrefix,Dt}function Yc(e){return Math.max(0,-gt(Math.abs(e)))}function Gc(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(gt(t)/3)))*3-gt(Math.abs(e)))}function jc(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,gt(t)-gt(e))+1}function Jc(e,t,n,r){var i=Pc(e,t,n),o;switch(r=sn(r==null?",f":r),r.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(o=Gc(i,s))&&(r.precision=o),to(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=jc(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=Yc(i))&&(r.precision=o-(r.type==="%")*2);break}}return eo(r)}function Wc(e){var t=e.domain;return e.ticks=function(n){var r=t();return Ac(r[0],r[r.length-1],n==null?10:n)},e.tickFormat=function(n,r){var i=t();return Jc(i[0],i[i.length-1],n==null?10:n,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,o=r.length-1,s=r[i],a=r[o],l,u,c=10;for(a<s&&(u=s,s=a,a=u,u=i,i=o,o=u);c-- >0;){if(u=Zi(s,a,n),u===l)return r[i]=s,r[o]=a,t(r);if(u>0)s=Math.floor(s/u)*u,a=Math.ceil(a/u)*u;else if(u<0)s=Math.ceil(s*u)/u,a=Math.floor(a*u)/u;else break;l=u}return e},e}function qn(){var e=Dc();return e.copy=function(){return Uc(e,qn())},Tc.apply(e,arguments),Wc(e)}function Zc(e){let t,n;return{c(){t=ee("div"),n=ee("canvas"),this.h()},l(r){t=te(r,"DIV",{class:!0});var i=W(t);n=te(i,"CANVAS",{width:!0,height:!0,class:!0}),W(n).forEach(D),i.forEach(D),this.h()},h(){P(n,"width",e[3]),P(n,"height",e[2]),P(n,"class","absolute top-0 left-0 svelte-6dcxg7"),P(t,"class","absolute top-0 left-0 right-0 bottom-0 overflow-hidden z-0")},m(r,i){le(r,t,i),K(t,n),e[5](n),e[6](t)},p:ge,i:ge,o:ge,d(r){r&&D(t),e[5](null),e[6](null)}}}const zt=10;function Qc(e,t,n){let r,i,o,s,a;he(e,rt,y=>n(10,r=y)),he(e,Kn,y=>n(11,i=y)),he(e,Dn,y=>n(12,o=y)),he(e,Ot,y=>n(13,s=y)),he(e,tn,y=>n(4,a=y));const l=512*5,u=512*5;let{value:c}=t,f,p;an(()=>{qn().domain([0,u]).range([0,u]),qn().domain([0,l]).range([0,l]);const y=u/f.clientWidth,E=su().scaleExtent([1/y/1.5,1]).translateExtent([[-u*.1,-l*.1],[u*1.1,l*1.1]]).tapDistance(10).on("zoom",O);Ve(c.parentElement).call(E).on("dblclick.zoom",()=>(re(Ot,s=!0,s),re(Dn,o=r.cursor,o),console.log("clicked",o),null)).on("pointermove",U).on("pointerleave",H),p=c.getContext("2d"),p.strokeStyle="blue",p.lineWidth=10,p.strokeRect(0,0,u,l)});function v(y){[...y.toImmutable()].sort((M,T)=>M.date-T.date).forEach(({imgURL:M,position:T})=>{const I=new Image;I.onload=()=>{p.drawImage(I,T.x,T.y,I.width,I.height)},M.split("/"),I.src=M})}function O(y){const E=re(Kn,i=y.transform,i);n(0,c.style.transform=`translate(${E.x}px, ${E.y}px) scale(${E.k})`,c)}function U(y){y.preventDefault();const E=Math.round(i.invertX(y.layerX)/zt)*zt,M=Math.round(i.invertY(y.layerY)/zt)*zt;re(rt,r={cursor:{x:E,y:M}},r)}function H(){re(rt,r={cursor:null},r)}function b(y){An[y?"unshift":"push"](()=>{c=y,n(0,c)})}function B(y){An[y?"unshift":"push"](()=>{f=y,n(1,f)})}return e.$$set=y=>{"value"in y&&n(0,c=y.value)},e.$$.update=()=>{e.$$.dirty&16&&a&&v(a)},[c,f,l,u,a,b,B]}class ef extends Ye{constructor(t){super(),Ge(this,t,Qc,Zc,je,{value:0})}}function tf(e){let t,n,r,i,o,s,a,l,u,c,f,p,v,O,U,H,b,B,y,E,M,T;return{c(){t=ee("div"),n=ee("div"),r=ee("input"),i=ue(),o=ee("label"),s=xe("Show Frames"),a=ue(),l=ee("div"),u=ee("input"),c=ue(),f=ee("label"),p=xe("Text2Image"),v=ue(),O=ee("button"),U=xe("Add Prompt"),H=ue(),b=ee("button"),B=ee("span"),y=xe("+"),E=xe(`
		Paint`),this.h()},l(I){t=te(I,"DIV",{class:!0});var S=W(t);n=te(S,"DIV",{class:!0});var V=W(n);r=te(V,"INPUT",{id:!0,type:!0,class:!0}),i=ce(V),o=te(V,"LABEL",{for:!0,class:!0});var ie=W(o);s=Ee(ie,"Show Frames"),ie.forEach(D),V.forEach(D),a=ce(S),l=te(S,"DIV",{class:!0});var g=W(l);u=te(g,"INPUT",{id:!0,type:!0,class:!0}),c=ce(g),f=te(g,"LABEL",{for:!0,class:!0});var F=W(f);p=Ee(F,"Text2Image"),F.forEach(D),g.forEach(D),v=ce(S),O=te(S,"BUTTON",{class:!0,title:!0});var Y=W(O);U=Ee(Y,"Add Prompt"),Y.forEach(D),H=ce(S),b=te(S,"BUTTON",{class:!0,title:!0});var d=W(b);B=te(d,"SPAN",{class:!0});var x=W(B);y=Ee(x,"+"),x.forEach(D),E=Ee(d,`
		Paint`),d.forEach(D),S.forEach(D),this.h()},h(){P(r,"id","showframes"),P(r,"type","checkbox"),P(r,"class","w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"),P(o,"for","showframes"),P(o,"class","text-black dark:text-white cursor-pointer ml-2"),P(n,"class","flex items-center"),P(u,"id","txt2img"),P(u,"type","checkbox"),P(u,"class","w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer"),P(f,"for","txt2img"),P(f,"class","text-black dark:text-white cursor-pointer ml-2"),P(l,"class","flex items-center"),P(O,"class","button svelte-3z1a8v"),P(O,"title","Add Prompt"),P(B,"class","rounded-sm h-5 w-5 m-1 flex justify-center items-center border-2 border-dashed border-violet-700 mr-2"),P(b,"class","button-paint bg-violet-100 text-violet-900 svelte-3z1a8v"),P(b,"title","New Paint Frame"),P(t,"class","grid grid-cols-4 gap-3 text-sm w-max mx-auto")},m(I,S){le(I,t,S),K(t,n),K(n,r),r.checked=e[0],K(n,i),K(n,o),K(o,s),K(t,a),K(t,l),K(l,u),u.checked=e[1],K(l,c),K(l,f),K(f,p),K(t,v),K(t,O),K(O,U),K(t,H),K(t,b),K(b,B),K(B,y),K(b,E),M||(T=[ct(r,"change",e[2]),ct(u,"change",e[3])],M=!0)},p(I,[S]){S&1&&(r.checked=I[0]),S&2&&(u.checked=I[1])},i:ge,o:ge,d(I){I&&D(t),M=!1,ei(T)}}}function nf(e,t,n){let r,i;he(e,zn,a=>n(0,r=a)),he(e,Fn,a=>n(1,i=a));function o(){r=this.checked,zn.set(r)}function s(){i=this.checked,Fn.set(i)}return[r,i,o,s]}class rf extends Ye{constructor(t){super(),Ge(this,t,nf,tf,je,{})}}function of(e){let t,n,r,i;return{c(){t=ee("form"),n=ee("input"),this.h()},l(o){t=te(o,"FORM",{class:!0});var s=W(t);n=te(s,"INPUT",{class:!0,placeholder:!0,title:!0,type:!0,name:!0}),s.forEach(D),this.h()},h(){P(n,"class","input svelte-4r5yqh"),P(n,"placeholder","Type a prompt..."),P(n,"title","Input prompt to generate image and obtain palette"),P(n,"type","text"),P(n,"name","prompt"),P(t,"class","fixed w-screen top-0 left-0 bottom-0 right-0 max-h-screen z-50 flex items-center justify-center bg-black bg-opacity-80 px-3")},m(o,s){le(o,t,s),K(t,n),dr(n,e[0]),r||(i=[ct(n,"click",yo(e[2])),ct(n,"input",e[3]),ct(t,"submit",wo(e[4])),ct(t,"click",e[5])],r=!0)},p(o,[s]){s&1&&n.value!==o[0]&&dr(n,o[0])},i:ge,o:ge,d(o){o&&D(t),r=!1,ei(i)}}}function sf(e,t,n){const r=bo();let i;const o=c=>{c.key==="Escape"&&r("close")};an(()=>(window.addEventListener("keyup",o),()=>{window.removeEventListener("keyup",o)}));function s(c){ko.call(this,e,c)}function a(){i=this.value,n(0,i)}return[i,r,s,a,()=>r("prompt",{prompt:i}),()=>r("close")]}class af extends Ye{constructor(t){super(),Ge(this,t,sf,of,je,{})}}var no={},ro={},lr={exports:{}},Q=String,io=function(){return{isColorSupported:!1,reset:Q,bold:Q,dim:Q,italic:Q,underline:Q,inverse:Q,hidden:Q,strikethrough:Q,black:Q,red:Q,green:Q,yellow:Q,blue:Q,magenta:Q,cyan:Q,white:Q,gray:Q,bgBlack:Q,bgRed:Q,bgGreen:Q,bgYellow:Q,bgBlue:Q,bgMagenta:Q,bgCyan:Q,bgWhite:Q}};lr.exports=io();lr.exports.createColors=io;(function(e){Object.defineProperty(e,"__esModule",{value:!0});function t(l,u){for(var c in u)Object.defineProperty(l,c,{enumerable:!0,get:u[c]})}t(e,{dim:()=>s,default:()=>a});const n=r(lr.exports);function r(l){return l&&l.__esModule?l:{default:l}}let i=new Set;function o(l,u,c){typeof process<"u"&&process.env.JEST_WORKER_ID||c&&i.has(c)||(c&&i.add(c),console.warn(""),u.forEach(f=>console.warn(l,"-",f)))}function s(l){return n.default.dim(l)}const a={info(l,u){o(n.default.bold(n.default.cyan("info")),...Array.isArray(l)?[l]:[u,l])},warn(l,u){o(n.default.bold(n.default.yellow("warn")),...Array.isArray(l)?[l]:[u,l])},risk(l,u){o(n.default.bold(n.default.magenta("risk")),...Array.isArray(l)?[l]:[u,l])}}})(ro);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:()=>i});const t=n(ro);function n(o){return o&&o.__esModule?o:{default:o}}function r({version:o,from:s,to:a}){t.default.warn(`${s}-color-renamed`,[`As of Tailwind CSS ${o}, \`${s}\` has been renamed to \`${a}\`.`,"Update your configuration file to silence this warning."])}const i={inherit:"inherit",current:"currentColor",transparent:"transparent",black:"#000",white:"#fff",slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},zinc:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63"},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843"},rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337"},get lightBlue(){return r({version:"v2.2",from:"lightBlue",to:"sky"}),this.sky},get warmGray(){return r({version:"v3.0",from:"warmGray",to:"stone"}),this.stone},get trueGray(){return r({version:"v3.0",from:"trueGray",to:"neutral"}),this.neutral},get coolGray(){return r({version:"v3.0",from:"coolGray",to:"gray"}),this.gray},get blueGray(){return r({version:"v3.0",from:"blueGray",to:"slate"}),this.slate}}})(no);let In=no;var lf=(In.__esModule?In:{default:In}).default;const be=Object.values(lf).filter(e=>typeof e=="object").map(e=>e[200]).slice(0,18),Et=["\u{1F436}","\u{1F431}","\u{1F42D}","\u{1F439}","\u{1F430}","\u{1F98A}","\u{1F43B}","\u{1F43C}","\u{1F428}","\u{1F42F}","\u{1F981}","\u{1F42E}","\u{1F432}","\u{1F31A}","\u{1F31D}","\u{1F31E}","\u{1F31B}","\u{1F31C}"];function uf(e){return new Promise(t=>{const n=new Image;n.onload=async()=>{const r=n.width,i=n.height,o=document.createElement("canvas");o.width=r,o.height=i,o.getContext("2d").drawImage(n,0,0,r,i);const a=await new Promise(l=>o.toBlob(l,"image/jpeg",.95));t(a)},n.src=e})}async function cf(e,t){const n=ff(t),r="https://huggingface.co/uploads",o=`color-palette-${crypto.randomUUID().split("-")[0]}-${n}.jpeg`,s=new File([e],o,{type:"image/jpeg"});console.log("uploading image",s);const l=await(await fetch(r,{method:"POST",headers:{"Content-Type":s.type,"X-Requested-With":"XMLHttpRequest"},body:s})).text();return console.log("uploaded images",l),l}function ff(e){return e?e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""):""}function Vr(e,t,n){const r=e.slice();return r[17]=t[n].connectionId,r[18]=t[n].presence,r}function Br(e,t,n){const r=e.slice();return r[21]=t[n],r[23]=n,r}function Xr(e){let t,n;return t=new af({}),t.$on("prompt",e[11]),t.$on("close",e[10]),{c(){Ie(t.$$.fragment)},l(r){Se(t.$$.fragment,r)},m(r,i){Ae(t,r,i),n=!0},p:ge,i(r){n||(q(t.$$.fragment,r),n=!0)},o(r){j(t.$$.fragment,r),n=!1},d(r){Pe(t,r)}}}function qr(e){let t,n,r=e[4],i=[];for(let s=0;s<r.length;s+=1)i[s]=Yr(Br(e,r,s));const o=s=>j(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();t=Re()},l(s){for(let a=0;a<i.length;a+=1)i[a].l(s);t=Re()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);le(s,t,a),n=!0},p(s,a){if(a&144){r=s[4];let l;for(l=0;l<r.length;l+=1){const u=Br(s,r,l);i[l]?(i[l].p(u,a),q(i[l],1)):(i[l]=Yr(u),i[l].c(),q(i[l],1),i[l].m(t.parentNode,t))}for(Xe(),l=r.length;l<i.length;l+=1)o(l);qe()}},i(s){if(!n){for(let a=0;a<r.length;a+=1)q(i[a]);n=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)j(i[a]);n=!1},d(s){Oo(i,s),s&&D(t)}}}function Yr(e){let t,n;return t=new pn({props:{color:be[0],position:e[4].get(e[23]).position,transform:e[7]}}),{c(){Ie(t.$$.fragment)},l(r){Se(t.$$.fragment,r)},m(r,i){Ae(t,r,i),n=!0},p(r,i){const o={};i&16&&(o.position=r[4].get(r[23]).position),i&128&&(o.transform=r[7]),t.$set(o)},i(r){n||(q(t.$$.fragment,r),n=!0)},o(r){j(t.$$.fragment,r),n=!1},d(r){Pe(t,r)}}}function Gr(e){let t,n;return t=new pn({props:{color:be[0],position:e[3],transform:e[7]}}),{c(){Ie(t.$$.fragment)},l(r){Se(t.$$.fragment,r)},m(r,i){Ae(t,r,i),n=!0},p(r,i){const o={};i&8&&(o.position=r[3]),i&128&&(o.transform=r[7]),t.$set(o)},i(r){n||(q(t.$$.fragment,r),n=!0)},o(r){j(t.$$.fragment,r),n=!1},d(r){Pe(t,r)}}}function jr(e){let t,n,r,i;return t=new pn({props:{color:be[0],position:e[8].cursor,transform:e[7]}}),r=new Ji({props:{emoji:Et[0],color:be[0],position:e[8].cursor,transform:e[7]}}),{c(){Ie(t.$$.fragment),n=ue(),Ie(r.$$.fragment)},l(o){Se(t.$$.fragment,o),n=ce(o),Se(r.$$.fragment,o)},m(o,s){Ae(t,o,s),le(o,n,s),Ae(r,o,s),i=!0},p(o,s){const a={};s&256&&(a.position=o[8].cursor),s&128&&(a.transform=o[7]),t.$set(a);const l={};s&256&&(l.position=o[8].cursor),s&128&&(l.transform=o[7]),r.$set(l)},i(o){i||(q(t.$$.fragment,o),q(r.$$.fragment,o),i=!0)},o(o){j(t.$$.fragment,o),j(r.$$.fragment,o),i=!1},d(o){Pe(t,o),o&&D(n),Pe(r,o)}}}function hf(e){let t=[],n=new Map,r,i,o=[...e[9]];const s=a=>a[17];for(let a=0;a<o.length;a+=1){let l=Vr(e,o,a),u=s(l);n.set(u,t[a]=Wr(u,l))}return{c(){for(let a=0;a<t.length;a+=1)t[a].c();r=Re()},l(a){for(let l=0;l<t.length;l+=1)t[l].l(a);r=Re()},m(a,l){for(let u=0;u<t.length;u+=1)t[u].m(a,l);le(a,r,l),i=!0},p(a,l){l&640&&(o=[...a[9]],Xe(),t=Io(t,l,s,1,a,o,n,r.parentNode,So,Wr,r,Vr),qe())},i(a){if(!i){for(let l=0;l<o.length;l+=1)q(t[l]);i=!0}},o(a){for(let l=0;l<t.length;l+=1)j(t[l]);i=!1},d(a){for(let l=0;l<t.length;l+=1)t[l].d(a);a&&D(r)}}}function Jr(e){let t,n,r,i;return t=new pn({props:{color:be[1+e[17]%(be.length-1)],position:e[18].cursor,transform:e[7]}}),r=new Ji({props:{emoji:Et[1+e[17]%(Et.length-1)],color:be[1+e[17]%(be.length-1)],position:e[18].cursor,transform:e[7]}}),{c(){Ie(t.$$.fragment),n=ue(),Ie(r.$$.fragment)},l(o){Se(t.$$.fragment,o),n=ce(o),Se(r.$$.fragment,o)},m(o,s){Ae(t,o,s),le(o,n,s),Ae(r,o,s),i=!0},p(o,s){const a={};s&512&&(a.color=be[1+o[17]%(be.length-1)]),s&512&&(a.position=o[18].cursor),s&128&&(a.transform=o[7]),t.$set(a);const l={};s&512&&(l.emoji=Et[1+o[17]%(Et.length-1)]),s&512&&(l.color=be[1+o[17]%(be.length-1)]),s&512&&(l.position=o[18].cursor),s&128&&(l.transform=o[7]),r.$set(l)},i(o){i||(q(t.$$.fragment,o),q(r.$$.fragment,o),i=!0)},o(o){j(t.$$.fragment,o),j(r.$$.fragment,o),i=!1},d(o){Pe(t,o),o&&D(n),Pe(r,o)}}}function Wr(e,t){var s;let n,r,i,o=((s=t[18])==null?void 0:s.cursor)&&Jr(t);return{key:e,first:null,c(){n=Re(),o&&o.c(),r=Re(),this.h()},l(a){n=Re(),o&&o.l(a),r=Re(),this.h()},h(){this.first=n},m(a,l){le(a,n,l),o&&o.m(a,l),le(a,r,l),i=!0},p(a,l){var u;t=a,(u=t[18])!=null&&u.cursor?o?(o.p(t,l),l&512&&q(o,1)):(o=Jr(t),o.c(),q(o,1),o.m(r.parentNode,r)):o&&(Xe(),j(o,1,1,()=>{o=null}),qe())},i(a){i||(q(o),i=!0)},o(a){j(o),i=!1},d(a){a&&D(n),o&&o.d(a),a&&D(r)}}}function df(e){var ie;let t,n,r,i,o,s,a,l,u,c,f,p,v,O,U,H,b,B,y=e[5]&&Xr(e);function E(g){e[13](g)}let M={};e[0]!==void 0&&(M.value=e[0]),l=new ef({props:M}),An.push(()=>xo(l,"value",E));let T=e[4]&&e[6]&&qr(e),I=e[3]&&Gr(e),S=((ie=e[8])==null?void 0:ie.cursor)&&jr(e),V=Pt&&hf(e);return b=new rf({}),{c(){t=ee("div"),n=xe(e[1]),r=ue(),i=xe(e[2]),o=ue(),y&&y.c(),s=ue(),a=ee("div"),Ie(l.$$.fragment),c=ue(),f=ee("main"),T&&T.c(),p=ue(),I&&I.c(),v=ue(),S&&S.c(),O=ue(),V&&V.c(),U=ue(),H=ee("div"),Ie(b.$$.fragment),this.h()},l(g){t=te(g,"DIV",{class:!0});var F=W(t);n=Ee(F,e[1]),r=ce(F),i=Ee(F,e[2]),F.forEach(D),o=ce(g),y&&y.l(g),s=ce(g),a=te(g,"DIV",{class:!0});var Y=W(a);Se(l.$$.fragment,Y),c=ce(Y),f=te(Y,"MAIN",{class:!0});var d=W(f);T&&T.l(d),p=ce(d),I&&I.l(d),v=ce(d),S&&S.l(d),O=ce(d),V&&V.l(d),d.forEach(D),Y.forEach(D),U=ce(g),H=te(g,"DIV",{class:!0});var x=W(H);Se(b.$$.fragment,x),x.forEach(D),this.h()},h(){P(t,"class","text touch-none pointer-events-none"),P(f,"class","z-10 relative"),P(a,"class","fixed top-0 left-0 z-0 w-screen h-screen"),P(H,"class","fixed bottom-0 left-0 right-0 z-10 my-2")},m(g,F){le(g,t,F),K(t,n),K(t,r),K(t,i),le(g,o,F),y&&y.m(g,F),le(g,s,F),le(g,a,F),Ae(l,a,null),K(a,c),K(a,f),T&&T.m(f,null),K(f,p),I&&I.m(f,null),K(f,v),S&&S.m(f,null),K(f,O),V&&V.m(f,null),le(g,U,F),le(g,H,F),Ae(b,H,null),B=!0},p(g,[F]){var d;(!B||F&2)&&Sn(n,g[1]),(!B||F&4)&&Sn(i,g[2]),g[5]?y?(y.p(g,F),F&32&&q(y,1)):(y=Xr(g),y.c(),q(y,1),y.m(s.parentNode,s)):y&&(Xe(),j(y,1,1,()=>{y=null}),qe());const Y={};!u&&F&1&&(u=!0,Y.value=g[0],Eo(()=>u=!1)),l.$set(Y),g[4]&&g[6]?T?(T.p(g,F),F&80&&q(T,1)):(T=qr(g),T.c(),q(T,1),T.m(f,p)):T&&(Xe(),j(T,1,1,()=>{T=null}),qe()),g[3]?I?(I.p(g,F),F&8&&q(I,1)):(I=Gr(g),I.c(),q(I,1),I.m(f,v)):I&&(Xe(),j(I,1,1,()=>{I=null}),qe()),(d=g[8])!=null&&d.cursor?S?(S.p(g,F),F&256&&q(S,1)):(S=jr(g),S.c(),q(S,1),S.m(f,O)):S&&(Xe(),j(S,1,1,()=>{S=null}),qe()),Pt&&V.p(g,F)},i(g){B||(q(y),q(l.$$.fragment,g),q(T),q(I),q(S),q(V),q(b.$$.fragment,g),B=!0)},o(g){j(y),j(l.$$.fragment,g),j(T),j(I),j(S),j(V),j(b.$$.fragment,g),B=!1},d(g){g&&D(t),g&&D(o),y&&y.d(g),g&&D(s),g&&D(a),Pe(l),T&&T.d(),I&&I.d(),S&&S.d(),V&&V.d(),g&&D(U),g&&D(H),Pe(b)}}}function pf(e,t,n){let r,i,o,s,a,l,u,c,f,p;he(e,we,E=>n(1,r=E)),he(e,lt,E=>n(2,i=E)),he(e,Dn,E=>n(3,o=E)),he(e,tn,E=>n(4,s=E)),he(e,Fn,E=>n(14,a=E)),he(e,Ot,E=>n(5,l=E)),he(e,zn,E=>n(6,u=E)),he(e,Kn,E=>n(7,c=E)),he(e,rt,E=>n(8,f=E)),he(e,Pt,E=>n(9,p=E));let{room:v}=t,O;an(()=>{});async function U(E){re(Ot,l=!1,l)}async function H(E){const M=E.detail.prompt,T=await B(M);re(Ot,l=!1,l),console.log("prompt",M,T)}function b(E){const M=document.createElement("canvas"),T=document.createElement("canvas"),I=document.createElement("canvas");M.width=512,M.height=512,T.width=512,T.height=512,I.width=512,I.height=512;const S=M.getContext("2d"),V=T.getContext("2d"),ie=I.getContext("2d");V.save(),V.clearRect(0,0,512,512),V.globalCompositeOperation="source-over",V.drawImage(O,E.x,E.y,512,512,0,0,512,512),V.restore(),S.fillStyle="white",S.fillRect(0,0,512,512),ie.save(),ie.drawImage(T,0,0,512,512),ie.globalCompositeOperation="source-out",ie.drawImage(M,0,0),ie.restore(),S.save(),S.fillStyle="white",S.fillRect(0,0,512,512),S.drawImage(T,0,0,512,512);const g=M.toDataURL("image/png");S.restore(),S.save(),S.fillStyle="black",S.fillRect(0,0,512,512),S.drawImage(I,0,0,512,512);const F=M.toDataURL("image/png");return S.restore(),{image:g,mask:F}}async function B(E){if(!E||i==!0)return;re(we,r="Pending",r),re(lt,i=!0,i);const M=crypto.randomUUID(),T={fn_index:0,data:[a?null:b(o),E,a],session_hash:M};console.log("payload",T);const I=new WebSocket(cu);I.onclose=S=>{S.wasClean||(re(we,r="Error",r),re(lt,i=!1,i))},I.onmessage=async function(S){try{const V=JSON.parse(S.data);switch(re(we,r="",r),V.msg){case"send_data":re(we,r="Sending Data",r),I.send(JSON.stringify(T));break;case"queue_full":re(we,r="Queue full",r),I.close(),re(lt,i=!1,i);return;case"estimation":const{msg:ie,rank:g,queue_size:F}=V;re(we,r=`On queue ${g}/${F}`,r);break;case"process_generating":re(we,r=V.success?"Generating":"Error",r);break;case"process_completed":try{const Y=V.output.data[0],d=V.output.data[1],x=await uf(Y),_=await cf(x,E);s.push({prompt:E,imgURL:_,position:o,date:new Date().getTime()}),console.log(_),re(we,r=V.success?"Complete":"Error",r)}catch(Y){re(we,r=Y.message,r)}I.close(),re(lt,i=!1,i);return;case"process_starts":re(we,r="Processing",r);break}}catch(V){console.error(V),re(lt,i=!1,i),re(we,r="Error",r)}}}function y(E){O=E,n(0,O)}return e.$$set=E=>{"room"in E&&n(12,v=E.room)},[O,r,i,o,s,l,u,c,f,p,U,H,v,y]}class mf extends Ye{constructor(t){super(),Ge(this,t,pf,df,je,{room:12})}}function Zr(e){let t,n;return t=new mf({props:{room:e[0]}}),{c(){Ie(t.$$.fragment)},l(r){Se(t.$$.fragment,r)},m(r,i){Ae(t,r,i),n=!0},p(r,i){const o={};i&1&&(o.room=r[0]),t.$set(o)},i(r){n||(q(t.$$.fragment,r),n=!0)},o(r){j(t.$$.fragment,r),n=!1},d(r){Pe(t,r)}}}function _f(e){let t,n,r,i,o,s,a=e[0]&&Zr(e);return{c(){t=ee("div"),n=ee("h1"),r=xe("Stable Diffussion Outpainting Multiplayer"),i=ue(),a&&a.c(),o=Re(),this.h()},l(l){t=te(l,"DIV",{class:!0});var u=W(t);n=te(u,"H1",{class:!0});var c=W(n);r=Ee(c,"Stable Diffussion Outpainting Multiplayer"),c.forEach(D),u.forEach(D),i=ce(l),a&&a.l(l),o=Re(),this.h()},h(){P(n,"class","text-lg md:text-3xl font-bold leading-normal"),P(t,"class","max-w-screen-md mx-auto p-5 relative pointer-events-none touch-none z-10")},m(l,u){le(l,t,u),K(t,n),K(n,r),le(l,i,u),a&&a.m(l,u),le(l,o,u),s=!0},p(l,[u]){l[0]?a?(a.p(l,u),u&1&&q(a,1)):(a=Zr(l),a.c(),q(a,1),a.m(o.parentNode,o)):a&&(Xe(),j(a,1,1,()=>{a=null}),qe())},i(l){s||(q(a),s=!0)},o(l){j(a),s=!1},d(l){l&&D(t),l&&D(i),a&&a.d(l),l&&D(o)}}}let Qr="multiplayer-SD";function gf(e,t,n){console.log("PUBLIC_DEV_MODE",uu),console.log("/embed/huggingface-projects/color-palette-generator-sd");let i,o;return an(()=>{i=mc({publicApiKey:"pk_test_JlUZGH3kQmhmZQiqU2l8eIi5"}),n(0,o=i.enter(Qr,{initialPresence:{cursor:null},initialStorage:{imagesList:new pc}})),o.subscribe("error",a=>{console.error("error",a)});const s=au(o);return lu(o),()=>{i&&o&&(i.leave(Qr),s())}}),[o]}class wf extends Ye{constructor(t){super(),Ge(this,t,gf,_f,je,{})}}export{wf as default};
